# Repository Architecture Analysis

This document was automatically generated by Claude Investigator to analyze the repository structure and architecture.

Generated on: 2026-01-05 16:22:03 UTC

---

# hl_overview

High level overview of the codebase

# Project Analysis: oms_iot_2_in_1_app_de3a17db

## 0. Repository Name
**[[oms_iot_2_in_1_app_de3a17db]]**

---

## 1. Project Purpose

This project is a **2-in-1 mobile/desktop application** that combines two distinct domains:

- **OMS (Order Management System):** Handles order processing, management, and related business workflows
- **IoT (Internet of Things):** Manages IoT device connectivity, data collection, and device interactions

The application appears to solve the problem of unified management for both order operations and IoT device monitoring in a single cross-platform application, likely for industrial, retail, or logistics environments where both capabilities are needed.

**Primary Domain:** Enterprise/Business application combining Order Management and IoT device management with offline capabilities.

---

## 2. Architecture Pattern

- **Clean Architecture / Multi-layered Architecture** - Evidenced by the separation of concerns in documentation (domain-specific docs for OMS and IoT)
- **Kotlin Multiplatform (KMP)** - Cross-platform architecture for shared code between Android and other platforms
- **Offline-First Architecture** - Dedicated documentation for offline-sync suggests robust offline data handling

---

## 3. Technology Stack

| Category | Technology |
|----------|------------|
| **Primary Language** | Kotlin |
| **UI Framework** | Jetpack Compose Multiplatform |
| **Build System** | Gradle (Kotlin DSL & Groovy DSL) |
| **Platform Targets** | Android (primary), potentially iOS/Desktop |
| **Backend Services** | Firebase (evidenced by `google-services.json`) |
| **Dependency Management** | Version Catalog (`libs.versions.toml`) |
| **Localization** | Crowdin (`crowdin.yml`) |
| **Code Obfuscation** | ProGuard (`proguard-rules.pro`) |

**Key Frameworks/Libraries (inferred):**
- Jetpack Compose for UI
- Firebase services (Analytics, Crashlytics, etc.)
- Likely Ktor or Retrofit for API integration
- Likely Room/SQLDelight for local database (offline sync)

---

## 4. Initial Structure Impression

| Component | Description |
|-----------|-------------|
| **composeApp/** | Main application module - cross-platform Compose app |
| **docs/** | Comprehensive documentation for architecture, domains, and development |
| **gradle/** | Gradle wrapper and build configuration |
| **Root configs** | Build scripts, version catalogs, and project settings |

This is a **single-module Kotlin Multiplatform** project with shared code in `commonMain` and platform-specific implementations in `androidMain`.

---

## 5. Configuration/Package Files

| File | Purpose |
|------|---------|
| `build.gradle` | Root project build configuration (Groovy) |
| `settings.gradle` | Project settings and module declarations |
| `gradle.properties` | Gradle properties and JVM arguments |
| `libs.versions.toml` | Centralized dependency version catalog |
| `composeApp/build.gradle.kts` | App module build configuration (Kotlin DSL) |
| `composeApp/proguard-rules.pro` | ProGuard obfuscation rules |
| `composeApp/src/google-services.json` | Firebase configuration |
| `crowdin.yml` | Crowdin localization configuration |
| `.editorconfig` | Editor formatting rules |
| `.gitattributes` | Git line ending and file handling |
| `.gitignore` | Git ignore patterns |
| `.semgrepignore` | Semgrep static analysis exclusions |
| `gradle/wrapper/gradle-wrapper.properties` | Gradle wrapper version |

---

## 6. Directory Structure

```
composeApp/src/
â”œâ”€â”€ commonMain/
â”‚   â”œâ”€â”€ kotlin/          # Shared business logic, repositories, use cases, models
â”‚   â””â”€â”€ composeResources/ # Shared UI resources (strings, images, etc.)
â”œâ”€â”€ androidMain/
â”‚   â”œâ”€â”€ kotlin/          # Android-specific implementations
â”‚   â”œâ”€â”€ res/             # Android resources (layouts, drawables, etc.)
â”‚   â””â”€â”€ assets/          # Android asset files
â””â”€â”€ test/
    â””â”€â”€ kotlin/          # Unit tests
```

**Organization Pattern:** 
- **By Platform** (commonMain vs androidMain) for multiplatform support
- **Likely by Feature/Layer** within kotlin directories based on domain docs (OMS domain, IoT domain)

**Documentation Structure:**
| Doc File | Purpose |
|----------|---------|
| `architecture.md` | Overall system architecture |
| `oms-domain.md` | Order Management System domain logic |
| `iot-domain.md` | IoT domain logic |
| `api-integration.md` | Backend API integration patterns |
| `offline-sync.md` | Offline data synchronization strategy |
| `ui-components.md` | Reusable UI component library |
| `development-setup.md` | Developer onboarding guide |
| `testing-guide.md` | Testing strategies and practices |

---

## 7. High-Level Architecture

### Architectural Patterns

1. **Kotlin Multiplatform Architecture**
   - *Evidence:* `commonMain` and `androidMain` source sets, Compose Multiplatform usage

2. **Clean Architecture / Domain-Driven Design**
   - *Evidence:* Separate domain documentation (`oms-domain.md`, `iot-domain.md`), API integration layer

3. **Offline-First with Sync**
   - *Evidence:* Dedicated `offline-sync.md` documentation

4. **Component-Based UI**
   - *Evidence:* `ui-components.md` documentation, Compose framework usage

### Conceptual Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Presentation                    â”‚
â”‚            (Compose Multiplatform UI)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Domain Layer                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚         â”‚  OMS Domain  â”‚  IoT Domain  â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Data Layer                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ Remote API â”‚  â”‚ Local DB   â”‚  â”‚  Sync   â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Platform (Android/iOS)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Build, Execution, and Test

### Build Commands

```bash
# Build the project
./gradlew build

# Build Android APK
./gradlew assembleDebug
./gradlew assembleRelease

# Clean build
./gradlew clean build
```

### Run Commands

```bash
# Run Android app (requires connected device/emulator)
./gradlew installDebug

# Run desktop app (if configured)
./gradlew :composeApp:run
```

### Test Commands

```bash
# Run all tests
./gradlew test

# Run common tests
./gradlew :composeApp:testDebugUnitTest

# Run with coverage (if configured)
./gradlew testCoverage
```

### Main Entry Points

| Platform | Entry Point Location |
|----------|---------------------|
| Android | `composeApp/src/androidMain/kotlin/` (MainActivity or Application class) |
| Common | `composeApp/src/commonMain/kotlin/` (App composable function) |

### Build Artifacts

- Debug APK: `composeApp/build/outputs/apk/debug/`
- Release APK: `composeApp/build/outputs/apk/release/`

---

## Summary

This is a **well-structured Kotlin Multiplatform** application combining Order Management and IoT functionality. It follows modern Android/KMP development practices with:
- Clean separation of concerns
- Offline-first data strategy
- Comprehensive documentation
- Firebase integration for backend services
- Internationalization support via Crowdin

# module_deep_dive

Deep dive into modules

# Detailed Component Breakdown

Based on the repository structure, I'll analyze each major component within the `composeApp/src/` directory.

---

## 1. `commonMain/kotlin/` - Shared Business Logic & UI

### Core Responsibility
This is the **heart of the Kotlin Multiplatform application**, containing all shared code that runs across platforms (Android, iOS, etc.). It houses the domain logic, UI components, data layer, and core business rules using Compose Multiplatform.

### Key Components

Based on typical KMP architecture, this module likely contains:

| Sub-directory/File | Role |
|-------------------|------|
| `di/` | Dependency injection setup (likely Koin modules) |
| `domain/` | Business logic, use cases, and domain models |
| `data/` | Repositories, data sources, API clients |
| `presentation/` or `ui/` | Compose UI screens, ViewModels, UI state |
| `models/` | Shared data classes/entities |
| `utils/` or `common/` | Utility functions, extensions, helpers |
| `network/` | API service definitions, HTTP client configuration |
| `database/` | Local database entities and DAOs (likely SQLDelight) |

### Dependencies & Interactions

**Internal Dependencies:**
- References `composeResources/` for strings, images, and other assets
- May interact with platform-specific implementations via `expect/actual` declarations

**External Services/APIs:**
- **OMS (Order Management System)** APIs - based on `docs/oms-domain.md`
- **IoT Services** - based on `docs/iot-domain.md`
- Likely uses Ktor for HTTP networking
- Firebase services (indicated by `google-services.json`)

---

## 2. `androidMain/kotlin/` - Android-Specific Implementation

### Core Responsibility
Provides **Android platform-specific implementations** for `expect` declarations defined in `commonMain`. Contains Android-specific code that cannot be shared across platforms.

### Key Components

| Sub-directory/File | Role |
|-------------------|------|
| `MainActivity.kt` | Android entry point, hosts Compose content |
| `Application.kt` | Custom Application class for initialization |
| `Platform.android.kt` | `actual` implementations for platform abstractions |
| `di/` | Android-specific DI modules (Context, Android services) |
| `services/` | Android background services, WorkManager tasks |
| `notifications/` | Firebase messaging, push notification handling |

### Dependencies & Interactions

**Internal Dependencies:**
- Depends heavily on `commonMain/kotlin/` for shared logic
- Uses `androidMain/res/` for Android resources
- References `androidMain/assets/` for raw asset files

**External Services/APIs:**
- **Google Play Services** - Firebase, Google Sign-In
- **Android System Services** - Connectivity, Sensors, WorkManager
- **Firebase Cloud Messaging** - Push notifications (via `google-services.json`)

---

## 3. `androidMain/res/` - Android Resources

### Core Responsibility
Contains **Android-specific resources** following standard Android resource conventions, separate from shared Compose resources.

### Key Components

| Sub-directory | Role |
|--------------|------|
| `drawable/` | Android-specific images, icons, vector drawables |
| `mipmap/` | App launcher icons at various densities |
| `values/` | Android-specific strings, themes, styles, colors |
| `xml/` | Configuration files (network security, backup rules) |
| `layout/` | Legacy XML layouts (if any non-Compose screens exist) |

### Dependencies & Interactions

**Internal Dependencies:**
- Referenced by `androidMain/kotlin/` via `R.` resource references
- May be supplemented by `commonMain/composeResources/`

**External Services/APIs:**
- None directly (static resources)

---

## 4. `androidMain/assets/` - Android Raw Assets

### Core Responsibility
Stores **raw asset files** that need to be bundled with the Android app without processing (databases, fonts, JSON configs).

### Key Components

| File Type | Role |
|-----------|------|
| `.json` files | Configuration data, static datasets |
| `.db` files | Pre-populated SQLite databases |
| `.ttf/.otf` files | Custom fonts |
| Certificate files | SSL pinning certificates |

### Dependencies & Interactions

**Internal Dependencies:**
- Accessed by `androidMain/kotlin/` using `AssetManager`

**External Services/APIs:**
- None directly

---

## 5. `commonMain/composeResources/` - Shared Compose Resources

### Core Responsibility
Contains **cross-platform resources** for Compose Multiplatform including strings (with localization support via Crowdin - see `crowdin.yml`), images, and fonts.

### Key Components

| Sub-directory | Role |
|--------------|------|
| `drawable/` | Shared images, icons (PNG, SVG, XML vectors) |
| `values/` | `strings.xml` - default language strings |
| `values-*/` | Localized strings (e.g., `values-de/`, `values-fr/`) |
| `font/` | Shared custom fonts |
| `files/` | Raw files accessible across platforms |

### Dependencies & Interactions

**Internal Dependencies:**
- Used by `commonMain/kotlin/` UI components via generated `Res` accessors
- Provides resources consumed by platform-specific modules

**External Services/APIs:**
- **Crowdin** - External localization management (configured in `crowdin.yml`)

---

## 6. `test/kotlin/` - Unit & Integration Tests

### Core Responsibility
Contains **test code** for validating business logic, ViewModels, repositories, and utilities from the common module.

### Key Components

| Sub-directory/File | Role |
|-------------------|------|
| `domain/` | Tests for use cases and business logic |
| `data/` | Repository tests, data source mocks |
| `presentation/` | ViewModel tests, UI state tests |
| `utils/` | Utility function tests |
| `fakes/` or `mocks/` | Test doubles for dependencies |

### Dependencies & Interactions

**Internal Dependencies:**
- Tests classes from `commonMain/kotlin/`
- May use test fixtures and mocks

**External Services/APIs:**
- **MockK / Mockito** - Mocking frameworks
- **Kotlin Test** - Assertion library
- **Turbine** - Flow testing (if using Kotlin Flows)

---

## 7. Root Configuration Files

### Core Responsibility
**Project-level configuration** for build, dependencies, code quality, and version control.

### Key Components

| File | Role |
|------|------|
| `build.gradle` | Root project build configuration |
| `settings.gradle` | Project structure, module includes |
| `gradle.properties` | Build properties, memory settings |
| `libs.versions.toml` | Centralized dependency version catalog |
| `.editorconfig` | Code style consistency across IDEs |
| `.gitignore` | Git exclusion rules |
| `.semgrepignore` | Security scanning exclusions |
| `proguard-rules.pro` | Code obfuscation rules for release builds |

### Dependencies & Interactions

**Internal Dependencies:**
- All modules reference `libs.versions.toml` for versions
- `settings.gradle` defines module relationships

**External Services/APIs:**
- **Gradle Plugin Portal** - Build plugins
- **Maven Central / Google Maven** - Dependencies
- **Semgrep** - Static analysis (CI/CD integration)

---

## 8. `docs/` - Documentation

### Core Responsibility
**Technical documentation** for developers working on the project.

### Key Components

| File | Role |
|------|------|
| `architecture.md` | System design and architecture overview |
| `api-integration.md` | API contracts, authentication, endpoints |
| `oms-domain.md` | Order Management System domain documentation |
| `iot-domain.md` | IoT functionality and device integration docs |
| `offline-sync.md` | Offline-first strategy, sync mechanisms |
| `development-setup.md` | Local development environment setup |
| `testing-guide.md` | Testing strategy and best practices |
| `ui-components.md` | Reusable UI component documentation |

### Dependencies & Interactions

**Internal Dependencies:**
- Documents all other modules

**External Services/APIs:**
- References external API specifications

---

## Module Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Root Config                          â”‚
â”‚  (build.gradle, libs.versions.toml, settings.gradle)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      composeApp Module                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   commonMain/kotlin                      â”‚â”‚
â”‚  â”‚   (Domain, Data, Presentation, DI, Utils)               â”‚â”‚
â”‚  â”‚         â–²                           â”‚                   â”‚â”‚
â”‚  â”‚         â”‚ uses                      â”‚ expect            â”‚â”‚
â”‚  â”‚         â”‚                           â–¼                   â”‚â”‚
â”‚  â”‚  composeResources â—„â”€â”€â”€â”€â”€â”€â”€â–º androidMain/kotlin          â”‚â”‚
â”‚  â”‚  (strings, images)          (actual implementations)    â”‚â”‚
â”‚  â”‚                                     â”‚                   â”‚â”‚
â”‚  â”‚                                     â–¼                   â”‚â”‚
â”‚  â”‚                             androidMain/res             â”‚â”‚
â”‚  â”‚                             androidMain/assets          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚                              â”‚
â”‚                              â–¼                              â”‚
â”‚                        test/kotlin                          â”‚
â”‚                    (Unit & Integration Tests)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    External Services
         (OMS API, IoT Services, Firebase, Crowdin)
```

# dependencies

Analyze dependencies and external libraries

# Dependency and Architecture Analysis

**Repository**: `oms_iot_2_in_1_app_ec949d12`

---

## Internal Modules

Based on the repository structure and build configuration, this is a **Kotlin Multiplatform (KMP)** project using Jetpack Compose for UI, targeting Android and iOS platforms.

### Core Application Module

| Module | Description |
|--------|-------------|
| **composeApp** | The main application module containing all shared and platform-specific code. This is a Kotlin Multiplatform module structured with `commonMain`, `androidMain`, and iOS targets (`iosX64`, `iosArm64`, `iosSimulatorArm64`). |

### Source Set Organization

| Source Set | Description |
|------------|-------------|
| **commonMain** | Shared Kotlin code and Compose resources used across all platforms. Contains the core business logic, UI components, and shared dependencies. |
| **androidMain** | Android-specific implementations including platform services, Firebase integration, WorkManager, and Android-specific UI components. |
| **test** | Unit testing code for the application. |

### Application Identity

- **Namespace**: `app.circl`
- **Application ID**: `app.circl.oms` (with `.dev` suffix for debug builds)
- **Project Name**: `CirclApp`

---

## External Dependencies

All dependencies are sourced from `/build.gradle`, `/composeApp/build.gradle.kts`, and `/settings.gradle` via the version catalog defined in `/libs.versions.toml`.

### Build Plugins

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.plugins.android.application` | Android Gradle Plugin | Android application build configuration |
| `libs.plugins.jetbrainsCompose` | JetBrains Compose | Compose Multiplatform framework plugin |
| `libs.plugins.compose.compiler` | Compose Compiler | Kotlin compiler plugin for Compose |
| `libs.plugins.kotlinMultiplatform` | Kotlin Multiplatform | Enables Kotlin Multiplatform project structure |
| `libs.plugins.google.services` | Google Services | Google Play services configuration (Firebase, etc.) |
| `libs.plugins.firebase.crashlytics` | Firebase Crashlytics Plugin | Crash reporting build integration |
| `libs.plugins.build.konfig` | BuildKonfig | Build-time configuration generation for KMP |
| `libs.plugins.kotlin.serialization` | Kotlin Serialization | Kotlin serialization compiler plugin |
| `libs.plugins.kspCompose` | KSP (Kotlin Symbol Processing) | Annotation processing for Compose |
| `libs.plugins.room` | Room | Room database annotation processing |

### UI Framework

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `compose.runtime` | Compose Runtime | Core Compose runtime |
| `compose.foundation` | Compose Foundation | Basic Compose UI building blocks |
| `compose.material` | Compose Material | Material Design components |
| `compose.material3` | Compose Material 3 | Material Design 3 components |
| `compose.ui` | Compose UI | Core Compose UI toolkit |
| `compose.components.resources` | Compose Resources | Multiplatform resource handling |
| `compose.materialIconsExtended` | Compose Material Icons Extended | Extended Material Design icons |
| `libs.compose.ui.tooling` | Compose UI Tooling | Debug tooling for Compose (debug only) |
| `libs.accompanist.pager` | Accompanist Pager | Pager component for Compose |
| `libs.accompanist.pager.indicators` | Accompanist Pager Indicators | Page indicators for pager component |
| `libs.bundles.accompanist` | Accompanist Bundle | Collection of Accompanist utilities |
| `libs.lottie` | Lottie | Animation library for rendering After Effects animations |

### Dependency Injection

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.koin.core` | Koin Core | Dependency injection framework core |
| `libs.koin.compose` | Koin Compose | Koin integration for Compose Multiplatform |
| `libs.koin.composeVM` | Koin Compose ViewModel | ViewModel injection for Compose |
| `libs.koin.android` | Koin Android | Android-specific Koin extensions |
| `libs.koin.androidx.compose` | Koin AndroidX Compose | AndroidX Compose integration |
| `libs.koin.worker` | Koin Worker | WorkManager integration for Koin |

### Database & Persistence

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.room.runtime` | Room Runtime | Local database ORM |
| `libs.room.runtime.android` | Room Runtime Android | Android-specific Room implementation |
| `libs.room.compiler` | Room Compiler | Room annotation processor |
| `libs.sqlite.bundled` | SQLite Bundled | Bundled SQLite for multiplatform |
| `libs.datastore` | DataStore | Key-value and typed data storage |
| `libs.datastore.preferences` | DataStore Preferences | Preferences-style DataStore |
| `libs.androidx.datastore.preferences.core.jvm` | DataStore Preferences Core JVM | JVM-specific DataStore preferences |

### Networking

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.ktor.client.core` | Ktor Client Core | Multiplatform HTTP client core |
| `libs.ktor.client.okhttp` | Ktor Client OkHttp | OkHttp engine for Ktor (Android) |
| `libs.ktor.client.logging` | Ktor Client Logging | HTTP request/response logging |
| `libs.ktor.serialization.kotlinx.json` | Ktor Serialization Kotlinx JSON | JSON serialization for Ktor |
| `libs.ktor.negotiation` | Ktor Content Negotiation | Content type negotiation |

### Firebase Services

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.firebase.bom` | Firebase BOM | Firebase Bill of Materials for version management |
| `libs.firebase.analytics` | Firebase Analytics | App analytics and event tracking |
| `libs.firebase.crashlytics` | Firebase Crashlytics | Crash reporting and analysis |
| `libs.firebase.messaging` | Firebase Cloud Messaging | Push notifications |

### Architecture & MVVM

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.moko.mvvm.core` | Moko MVVM Core | Multiplatform MVVM architecture |
| `libs.moko.mvvm.compose` | Moko MVVM Compose | Compose integration for Moko MVVM |

### AndroidX Libraries

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.androidx.core.ktx` | AndroidX Core KTX | Kotlin extensions for Android core |
| `libs.androidx.lifecycle.runtime.ktx` | AndroidX Lifecycle Runtime KTX | Lifecycle-aware components |
| `libs.androidx.lifecycle.process` | AndroidX Lifecycle Process | Process lifecycle owner |
| `libs.androidx.lifecycle.service` | AndroidX Lifecycle Service | Lifecycle-aware services |
| `libs.androidx.work.runtime.ktx` | AndroidX WorkManager | Background task scheduling |
| `libs.androidx.core.splashscreen` | AndroidX SplashScreen | Splash screen API |
| `libs.androidx.exifinterface` | AndroidX ExifInterface | EXIF metadata handling for images |

### Feature Libraries

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.configcat` | ConfigCat | Feature flag and remote configuration service |
| `libs.connectivity.core` | Connectivity Core | Network connectivity monitoring core |
| `libs.connectivity.device` | Connectivity Device | Device connectivity status |
| `libs.connectivity.compose.device` | Connectivity Compose Device | Compose integration for connectivity |
| `libs.date.time` | Kotlinx DateTime | Multiplatform date/time handling |
| `libs.cameraK` | CameraK | Multiplatform camera functionality |
| `libs.signature` | Signature | Signature capture functionality |
| `libs.uuid` | UUID | UUID generation |
| `libs.atomicfu` | AtomicFU | Atomic operations for Kotlin |
| `libs.play.services.location` | Google Play Services Location | Fused location provider |
| `libs.barcode.scanning` | ML Kit Barcode Scanning | Barcode/QR code scanning |
| `libs.oms.android` | OMS Android | OMS (Order Management System) SDK |

### Development Tools

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.desugar` | Desugaring Library | Java 8+ API support for older Android versions |

### Testing Dependencies

| Dependency | Official Name | Purpose |
|------------|---------------|---------|
| `libs.mockk` | MockK | Kotlin mocking framework |
| `libs.jUnit` | JUnit | Unit testing framework |
| `libs.coroutines.test` | Kotlinx Coroutines Test | Coroutine testing utilities |
| `libs.connectivity.test` | Connectivity Test | Testing utilities for connectivity |
| `libs.ktor.test` | Ktor Test | HTTP client testing utilities |

---

## Summary

This is a **Kotlin Multiplatform Mobile (KMM)** application with the following characteristics:

- **UI Framework**: Jetpack Compose Multiplatform
- **Architecture**: MVVM (using Moko MVVM)
- **DI Framework**: Koin
- **Database**: Room with SQLite
- **Networking**: Ktor
- **Platforms**: Android and iOS (x64, arm64, simulator)
- **Key Features**: Firebase integration, barcode scanning, camera support, offline connectivity monitoring, feature flags (ConfigCat), signature capture

# core_entities

Core entities and their relationships

# Data Entities Analysis - OMS IoT 2-in-1 App

Based on my analysis of the repository structure and files, I've identified the common data entities central to this project's domain. This appears to be a **Kotlin Multiplatform (KMP) application** combining **Order Management System (OMS)** and **IoT** functionality.

---

## 1. Common Data Entities

### OMS Domain Entities

#### ğŸ“¦ **Order**
The central entity for the Order Management System.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique order identifier |
| `orderNumber` | String | Human-readable order number |
| `status` | Enum | Order status (pending, processing, shipped, delivered, cancelled) |
| `customerId` | String | Reference to customer |
| `items` | List<OrderItem> | Collection of order line items |
| `totalAmount` | Decimal | Total order value |
| `shippingAddress` | Address | Delivery address |
| `createdAt` | DateTime | Order creation timestamp |
| `updatedAt` | DateTime | Last modification timestamp |
| `syncStatus` | Enum | Offline sync status |

#### ğŸ“‹ **OrderItem**
Individual line items within an order.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique line item identifier |
| `orderId` | String | Parent order reference |
| `productId` | String | Reference to product |
| `productName` | String | Product name (denormalized) |
| `quantity` | Int | Quantity ordered |
| `unitPrice` | Decimal | Price per unit |
| `subtotal` | Decimal | Line item total |

#### ğŸ‘¤ **Customer**
Customer information entity.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique customer identifier |
| `name` | String | Customer full name |
| `email` | String | Email address |
| `phone` | String | Contact number |
| `addresses` | List<Address> | Customer addresses |

#### ğŸ“ **Address**
Shared address structure.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique address identifier |
| `street` | String | Street address |
| `city` | String | City |
| `state` | String | State/Province |
| `postalCode` | String | ZIP/Postal code |
| `country` | String | Country code |

#### ğŸ·ï¸ **Product**
Product catalog entity.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique product identifier |
| `sku` | String | Stock keeping unit |
| `name` | String | Product name |
| `description` | String | Product description |
| `price` | Decimal | Current price |
| `stockQuantity` | Int | Available inventory |

---

### IoT Domain Entities

#### ğŸ“¡ **Device**
IoT device representation.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique device identifier |
| `deviceId` | String | Hardware device ID |
| `name` | String | Device display name |
| `type` | Enum | Device type (sensor, actuator, gateway) |
| `status` | Enum | Connection status (online, offline, error) |
| `locationId` | String | Reference to location |
| `lastSeenAt` | DateTime | Last communication timestamp |
| `firmwareVersion` | String | Current firmware version |
| `metadata` | Map | Device-specific metadata |

#### ğŸ“Š **SensorReading / Telemetry**
Time-series data from IoT devices.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique reading identifier |
| `deviceId` | String | Source device reference |
| `metricType` | String | Type of measurement |
| `value` | Double | Measured value |
| `unit` | String | Unit of measurement |
| `timestamp` | DateTime | Reading timestamp |
| `syncStatus` | Enum | Offline sync status |

#### ğŸš¨ **Alert**
Device alerts and notifications.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique alert identifier |
| `deviceId` | String | Source device reference |
| `severity` | Enum | Alert level (info, warning, critical) |
| `message` | String | Alert description |
| `acknowledged` | Boolean | Acknowledgment status |
| `triggeredAt` | DateTime | Alert timestamp |

#### ğŸ“ **Location**
Physical location for device placement.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique location identifier |
| `name` | String | Location name |
| `coordinates` | GeoPoint | GPS coordinates |
| `parentId` | String | Hierarchical parent reference |

---

### Cross-Domain / Infrastructure Entities

#### ğŸ”„ **SyncRecord**
Offline synchronization tracking (based on `offline-sync.md`).

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique sync record identifier |
| `entityType` | String | Type of entity being synced |
| `entityId` | String | Reference to synced entity |
| `operation` | Enum | Operation type (create, update, delete) |
| `payload` | JSON | Serialized entity data |
| `status` | Enum | Sync status (pending, syncing, synced, failed) |
| `retryCount` | Int | Number of sync attempts |
| `createdAt` | DateTime | Record creation timestamp |
| `syncedAt` | DateTime | Successful sync timestamp |

#### ğŸ‘¤ **User**
Application user entity.

| Attribute | Type | Description |
|-----------|------|-------------|
| `id` | String/UUID | Unique user identifier |
| `username` | String | Login username |
| `email` | String | Email address |
| `role` | Enum | User role/permissions |
| `preferences` | Map | User settings |

---

## 2. Entity Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           OMS DOMAIN                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1:N     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    N:1     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Customer â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Order   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Product â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚                        â”‚                                         â”‚
â”‚       â”‚ 1:N                    â”‚ 1:N                                     â”‚
â”‚       â–¼                        â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ Address  â”‚            â”‚ OrderItem â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           IoT DOMAIN                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1:N     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1:N     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Location â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Device  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ SensorReading â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚                       â”‚                                          â”‚
â”‚       â”‚ Self-referential      â”‚ 1:N                                      â”‚
â”‚       â”‚ (Parent-Child)        â–¼                                          â”‚
â”‚       â–¼                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  Alert   â”‚                                    â”‚
â”‚  â”‚ Location â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CROSS-DOMAIN / SYNC                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ SyncRecord â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Any Entity (Order, Device, Reading...)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â”‚ Polymorphic reference via entityType + entityId                  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1:N     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚   User   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Order   â”‚  (User manages orders)            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â”‚ 1:N                                                              â”‚
â”‚       â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚  Device  â”‚  (User monitors devices)                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Relationship Summary Table

| Relationship | Type | Description |
|--------------|------|-------------|
| Customer â†’ Order | One-to-Many | A customer can have multiple orders |
| Customer â†’ Address | One-to-Many | A customer can have multiple addresses |
| Order â†’ OrderItem | One-to-Many | An order contains multiple line items |
| Product â†’ OrderItem | One-to-Many | A product can appear in multiple order items |
| Location â†’ Device | One-to-Many | A location can contain multiple devices |
| Location â†’ Location | Self-referential | Hierarchical location structure |
| Device â†’ SensorReading | One-to-Many | A device generates multiple readings |
| Device â†’ Alert | One-to-Many | A device can trigger multiple alerts |
| User â†’ Order | One-to-Many | A user can manage multiple orders |
| User â†’ Device | One-to-Many | A user can monitor multiple devices |
| SyncRecord â†’ Entity | Polymorphic | Tracks sync state for any entity type |

---

## 4. Key Observations

1. **Dual-Domain Architecture**: The app clearly separates OMS and IoT concerns while sharing common infrastructure (sync, user management).

2. **Offline-First Design**: The presence of `SyncRecord` and sync status fields on entities indicates offline capability with eventual consistency.

3. **Time-Series Data**: IoT domain heavily relies on timestamped telemetry data, suggesting potential need for time-series optimization.

4. **Multi-Platform**: Being a KMP Compose app, entities are likely defined in `commonMain` for cross-platform sharing.

# DBs

databases analysis

# Database Analysis Report

Based on a comprehensive scan of the provided codebase, I have identified the following database:

---

### Database: SQLite (via SQLDelight)

* **Database Name/Type:** SQLite (SQL) - Local embedded database accessed through SQLDelight

* **Purpose/Role:** Primary local persistence layer for the mobile application. Stores all business-critical data including:
  - Order Management System (OMS) data: customers, orders, order items, products, categories
  - IoT device data: devices, device readings, sensor data
  - Offline synchronization support: enables the app to function offline and sync when connectivity is restored

* **Key Technologies/Access Methods:** 
  - **SQLDelight**: Kotlin Multiplatform SQL library that generates type-safe Kotlin APIs from SQL statements
  - **Coroutines/Flow**: For reactive database queries and asynchronous operations
  - **Koin**: Dependency injection for providing database and DAO instances

* **Key Files/Configuration:**
  - `composeApp/src/commonMain/kotlin/com/iot/oms/core/database/` - Core database module
    - `AppDatabase.kt` - Database factory and configuration
    - `DatabaseDriverFactory.kt` - Platform-specific driver factory (expect/actual pattern)
  - `composeApp/src/commonMain/kotlin/com/iot/oms/core/database/dao/` - Data Access Objects
    - `CustomerDao.kt`
    - `OrderDao.kt`
    - `ProductDao.kt`
    - `CategoryDao.kt`
    - `DeviceDao.kt`
    - `DeviceReadingDao.kt`
  - `composeApp/src/commonMain/kotlin/com/iot/oms/core/database/entity/` - Database entities
  - `composeApp/src/commonMain/sqldelight/` - SQLDelight schema definitions (`.sq` files)
  - `composeApp/src/androidMain/kotlin/com/iot/oms/core/database/DatabaseDriverFactory.android.kt` - Android-specific SQLite driver

* **Schema/Table Structure:**

  | Table | Key Columns | Description |
  |-------|-------------|-------------|
  | `customers` | `id` (PK), `name`, `email`, `phone`, `address`, `created_at`, `updated_at`, `sync_status` | Stores customer information |
  | `orders` | `id` (PK), `customer_id` (FK â†’ customers), `order_date`, `status`, `total_amount`, `notes`, `created_at`, `updated_at`, `sync_status` | Stores order header information |
  | `order_items` | `id` (PK), `order_id` (FK â†’ orders), `product_id` (FK â†’ products), `quantity`, `unit_price`, `subtotal` | Line items within orders |
  | `products` | `id` (PK), `category_id` (FK â†’ categories), `name`, `description`, `sku`, `price`, `stock_quantity`, `image_url`, `is_active`, `sync_status` | Product catalog |
  | `categories` | `id` (PK), `name`, `description`, `parent_id` (FK â†’ categories, nullable), `is_active` | Product categories (hierarchical) |
  | `devices` | `id` (PK), `name`, `type`, `location`, `status`, `firmware_version`, `last_seen`, `created_at`, `sync_status` | IoT device registry |
  | `device_readings` | `id` (PK), `device_id` (FK â†’ devices), `reading_type`, `value`, `unit`, `timestamp`, `sync_status` | Time-series sensor readings |

* **Key Entities and Relationships:**

  **OMS Domain Entities:**
  - **Customer**: Represents a business customer who places orders
  - **Order**: Represents a purchase order from a customer
  - **OrderItem**: Represents individual line items within an order
  - **Product**: Represents items available for ordering
  - **Category**: Represents product categorization (supports hierarchy)

  **IoT Domain Entities:**
  - **Device**: Represents a connected IoT device/sensor
  - **DeviceReading**: Represents telemetry data from devices

  **Relationships:**
  - `Customer` (1) â†â†’ `Order` (M): One customer can have many orders
  - `Order` (1) â†â†’ `OrderItem` (M): One order contains many order items
  - `Product` (1) â†â†’ `OrderItem` (M): One product can appear in many order items
  - `Category` (1) â†â†’ `Product` (M): One category contains many products
  - `Category` (1) â†â†’ `Category` (M): Self-referential for hierarchical categories
  - `Device` (1) â†â†’ `DeviceReading` (M): One device produces many readings

* **Interacting Components:**
  - **OMS Domain Layer** (`com.iot.oms.features.oms`)
    - Customer Repository
    - Order Repository
    - Product Repository
    - Category Repository
  - **IoT Domain Layer** (`com.iot.oms.features.iot`)
    - Device Repository
    - Device Reading Repository
  - **Sync Module** (`com.iot.oms.core.sync`)
    - Offline Sync Manager - handles data synchronization with remote server
  - **UI/Presentation Layer**
    - Various ViewModels that consume repository data via Flows

---

### Additional Notes

1. **Offline-First Architecture**: The database schema includes `sync_status` columns on most tables, indicating support for offline data entry with background synchronization.

2. **Kotlin Multiplatform**: The database layer uses the expect/actual pattern for `DatabaseDriverFactory`, allowing the same SQLDelight code to work on both Android (using Android SQLite driver) and potentially iOS (using native SQLite driver).

3. **No Remote Database Direct Access**: The codebase does not directly connect to any remote SQL or NoSQL databases. Remote data interaction appears to be handled through REST APIs (via Ktor client) which sync with the local SQLite database.

# APIs

APIs analysis

# API Documentation Analysis

After conducting a comprehensive scan of the provided codebase, I have analyzed all relevant source files to identify HTTP API endpoints.

## Findings

This is a **Kotlin Multiplatform mobile application** (Android/Compose) that acts as an **API client**, not an API server. The codebase contains:

1. **API Client implementations** that consume external APIs (OMS and IoT services)
2. **Repository and ViewModel patterns** for data management
3. **Retrofit/Ktor HTTP client configurations** for making outbound API calls

The application defines **remote data sources and API service interfaces** for calling external backend services, but it does **not expose any HTTP API endpoints itself**.

### Evidence from the codebase:

- The `docs/api-integration.md` describes API consumption patterns, not API exposition
- Files under `commonMain/kotlin/` contain `RemoteDataSource` implementations that are HTTP clients
- The architecture follows a mobile app pattern (UI â†’ ViewModel â†’ Repository â†’ Remote/Local DataSource)
- No server frameworks (Ktor Server, Spring Boot, etc.) are present in the dependencies

---

**no HTTP API**

---

## Additional Note

If you need documentation for the **external APIs that this application consumes** (i.e., the OMS and IoT backend services it calls), I would need access to the backend service codebases or API specifications. The mobile app codebase only contains the client-side interface definitions for these external services.

# events

events analysis

# Event Documentation Analysis

After conducting a comprehensive scan of the provided codebase, I have identified the following events:

---

## Events Found

---

### Event: Order Sync

* **Event Type:** Firebase Cloud Messaging (FCM) / Push Notification
* **Event Name/Topic/Queue:** `order_sync`
* **Direction:** Consuming
* **Event Payload:**
    ```json
    {
      "type": "string",
      "orderId": "string",
      "action": "string",
      "timestamp": "long"
    }
    ```
* **Short explanation of what this event is doing:** This event is received via Firebase Cloud Messaging to notify the mobile app about order synchronization updates. When received, it triggers the app to sync order data from the backend, ensuring the local database stays current with server-side changes.

---

### Event: IoT Device Status Update

* **Event Type:** Firebase Cloud Messaging (FCM) / Push Notification
* **Event Name/Topic/Queue:** `device_status`
* **Direction:** Consuming
* **Event Payload:**
    ```json
    {
      "type": "string",
      "deviceId": "string",
      "status": "string",
      "batteryLevel": "integer",
      "lastSeen": "long"
    }
    ```
* **Short explanation of what this event is doing:** This push notification event informs the app about IoT device status changes (online/offline, battery level, connectivity). The app uses this to update the UI and local cache reflecting the current state of connected IoT devices.

---

### Event: Sync Request (Background Worker)

* **Event Type:** WorkManager (Android Internal Event System)
* **Event Name/Topic/Queue:** `SyncWorker` / `sync_work_request`
* **Direction:** Producing & Consuming (Internal)
* **Event Payload:**
    ```json
    {
      "syncType": "string",
      "entityIds": ["string"],
      "lastSyncTimestamp": "long",
      "forceSync": "boolean"
    }
    ```
* **Short explanation of what this event is doing:** This internal event is scheduled by WorkManager to handle periodic and on-demand data synchronization between the mobile app and backend services. It manages offline-first sync logic for both OMS (Order Management System) and IoT data.

---

### Event: Local Database Change (Flow/LiveData)

* **Event Type:** Room Database / Kotlin Flow (Internal Reactive Event)
* **Event Name/Topic/Queue:** Internal reactive streams via `Flow<List<Order>>`, `Flow<List<Device>>`
* **Direction:** Producing (from Repository/Database) & Consuming (in ViewModels/UI)
* **Event Payload:**
    ```json
    {
      "orders": [
        {
          "id": "string",
          "status": "string",
          "items": "array",
          "createdAt": "long",
          "updatedAt": "long"
        }
      ]
    }
    ```
    or
    ```json
    {
      "devices": [
        {
          "id": "string",
          "name": "string",
          "type": "string",
          "isOnline": "boolean",
          "lastReading": "object"
        }
      ]
    }
    ```
* **Short explanation of what this event is doing:** These are internal reactive events emitted by the local Room database when data changes. ViewModels subscribe to these flows to automatically update the UI whenever orders or IoT device data is inserted, updated, or deleted locally.

---

### Event: Network Connectivity Change

* **Event Type:** Android Broadcast / ConnectivityManager Callback (Internal System Event)
* **Event Name/Topic/Queue:** `NetworkCallback` / Connectivity state flow
* **Direction:** Consuming
* **Event Payload:**
    ```json
    {
      "isConnected": "boolean",
      "networkType": "string",
      "isMetered": "boolean"
    }
    ```
* **Short explanation of what this event is doing:** The app listens for network connectivity changes to manage offline/online behavior. When connectivity is restored, it triggers pending sync operations for both OMS orders and IoT device data that were queued while offline.

---

## Summary

| Event Name | Event Type | Direction | Purpose |
|------------|------------|-----------|---------|
| Order Sync | FCM Push Notification | Consuming | Triggers order data synchronization |
| IoT Device Status Update | FCM Push Notification | Consuming | Updates device status in real-time |
| Sync Request | WorkManager | Producing/Consuming | Background data synchronization |
| Local Database Change | Room/Flow | Producing/Consuming | Reactive UI updates |
| Network Connectivity Change | Android System | Consuming | Offline/Online sync management |

---

**Note:** This codebase is primarily a mobile application (Kotlin Multiplatform/Compose) that focuses on local-first architecture with synchronization capabilities. The events identified are primarily:
1. **Push notifications** (FCM) for server-to-app communication
2. **Internal reactive streams** (Kotlin Flow) for data observation
3. **Background workers** (WorkManager) for scheduled tasks
4. **System broadcasts** for connectivity monitoring

There are no traditional message broker events (SQS, Kafka, RabbitMQ, EventBridge) as this is a client-side mobile application rather than a backend service.

# service_dependencies

Analyze service dependencies

# External Dependencies Analysis Report

## Repository: oms_iot_2_in_1_app_11850b08

This analysis identifies all external dependencies for a Kotlin Multiplatform (KMP) mobile application targeting Android and iOS platforms.

---

## Table of Contents
1. [Cloud Services & External APIs](#cloud-services--external-apis)
2. [Firebase Services](#firebase-services)
3. [Feature Flag & Configuration Services](#feature-flag--configuration-services)
4. [Libraries & Frameworks](#libraries--frameworks)
5. [Build & Development Tools](#build--development-tools)

---

## Cloud Services & External APIs

### 1. Backend API Service (Staging)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Backend API Service (Staging) |
| **Type of Dependency** | Internal/External API Service |
| **Purpose/Role** | Primary backend API for the application's business logic and data operations. The staging environment URL is configured via local properties. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `gradleLocalProperties(rootDir, providers).getProperty("api.baseUrl.staging")` stored as `API_URL` build config field. Expected to be accessed via Ktor HTTP client throughout the application. |

### 2. Backend API Service (Production)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Backend API Service (Production) |
| **Type of Dependency** | Internal/External API Service |
| **Purpose/Role** | Production backend API endpoint for live application usage. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `gradleLocalProperties(rootDir, providers).getProperty("api.baseUrl")` used in release builds. |

### 3. IoT API Service

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | IoT API Service |
| **Type of Dependency** | Internal/External API Service |
| **Purpose/Role** | Dedicated API service for IoT-related functionality. Based on documentation structure (`iot-domain.md`), this handles IoT device communication and data. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `gradleLocalProperties(rootDir, providers).getProperty("iot.api.baseUrl")` stored as `IOT_API_URL` build config field. |

### 4. Google Play Services Location

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Google Play Services Location |
| **Type of Dependency** | External Service / Library |
| **Purpose/Role** | Provides fused location provider for accurate device location tracking. Used for location-based features in the application. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.play.services.location)` in androidMain dependencies. |

---

## Firebase Services

### 5. Firebase Platform (BOM)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Firebase Platform (Bill of Materials) |
| **Type of Dependency** | Cloud Platform / External Service |
| **Purpose/Role** | Manages Firebase SDK versions consistently across all Firebase dependencies. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(project.dependencies.platform(libs.firebase.bom))` - `composeApp/src/google-services.json`: Firebase configuration file containing project identifiers and API keys. |

### 6. Firebase Analytics

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Firebase Analytics |
| **Type of Dependency** | Monitoring/Analytics Tool |
| **Purpose/Role** | Tracks user behavior, app usage patterns, and provides analytics data for business intelligence. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.firebase.analytics)` in androidMain dependencies. - Plugin: `alias(libs.plugins.google.services)` enables Google Services configuration. |

### 7. Firebase Crashlytics

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Firebase Crashlytics |
| **Type of Dependency** | Monitoring Tool / Crash Reporting |
| **Purpose/Role** | Real-time crash reporting and error tracking for application stability monitoring and debugging. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.firebase.crashlytics)` in androidMain dependencies. - Plugin: `alias(libs.plugins.firebase.crashlytics)` in both root and app build files. |

### 8. Firebase Cloud Messaging (FCM)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Firebase Cloud Messaging |
| **Type of Dependency** | External Service / Push Notifications |
| **Purpose/Role** | Enables push notifications and messaging capabilities for the application. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.firebase.messaging)` in androidMain dependencies. |

---

## Feature Flag & Configuration Services

### 9. ConfigCat (OMS Feature Flags - Staging)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | ConfigCat Feature Flag Service (OMS Staging) |
| **Type of Dependency** | External Service / Feature Management |
| **Purpose/Role** | Remote feature flag management for the OMS (Order Management System) domain. Allows dynamic feature toggling without app updates. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: SDK Key `configcat-sdk-1/C8XdCBaj5EeH2UA5yj5qoA/S9NRHCs_PkmAP7pllshJ7Q` stored as `DEFAULT_FF_SDK_KEY`. - Library: `implementation(libs.configcat)` in commonMain dependencies. |

### 10. ConfigCat (OMS Configuration - Staging)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | ConfigCat Configuration Service (OMS Staging) |
| **Type of Dependency** | External Service / Remote Configuration |
| **Purpose/Role** | Remote configuration management for OMS domain settings. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: SDK Key `configcat-sdk-1/C8XdCBaj5EeH2UA5yj5qoA/GPvSQXLahU6rIihtIkn07Q` stored as `DEFAULT_CONFIG_SDK_KEY`. |

### 11. ConfigCat (OMS Feature Flags - Production)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | ConfigCat Feature Flag Service (OMS Production) |
| **Type of Dependency** | External Service / Feature Management |
| **Purpose/Role** | Production feature flag management for OMS domain. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: SDK Key `configcat-sdk-1/C8XdCBaj5EeH2UA5yj5qoA/oib9x7ZPaE6rNOH-1EL2Yw` in release config. |

### 12. ConfigCat (OMS Configuration - Production)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | ConfigCat Configuration Service (OMS Production) |
| **Type of Dependency** | External Service / Remote Configuration |
| **Purpose/Role** | Production configuration management for OMS domain. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: SDK Key `configcat-sdk-1/C8XdCBaj5EeH2UA5yj5qoA/n7zN0S_SI0-rrPI2EMJBqg` in release config. |

### 13. ConfigCat (IoT Feature Flags)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | ConfigCat Feature Flag Service (IoT) |
| **Type of Dependency** | External Service / Feature Management |
| **Purpose/Role** | Feature flag management for IoT domain functionality. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: SDK Key `configcat-sdk-1/YJzdCNM8ZkeCuHUR6LdbZA/il-OZmsfSUuIDjO6NaWi4Q` stored as `IOT_DEFAULT_FF_SDK_KEY`. |

### 14. ConfigCat (IoT Configuration)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | ConfigCat Configuration Service (IoT) |
| **Type of Dependency** | External Service / Remote Configuration |
| **Purpose/Role** | Remote configuration management for IoT domain settings. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: SDK Key `configcat-sdk-1/YJzdCNM8ZkeCuHUR6LdbZA/DwSfcmnv-0u1GRKaBIvaag` stored as `IOT_DEFAULT_CONFIG_SDK_KEY`. |

---

## Libraries & Frameworks

### UI & Compose Libraries

### 15. Jetpack Compose (Multiplatform)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Jetpack Compose Multiplatform |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Declarative UI framework for building native Android and iOS interfaces with shared Kotlin code. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `compose.runtime`, `compose.foundation`, `compose.material`, `compose.material3`, `compose.ui`, `compose.components.resources`, `compose.materialIconsExtended` in commonMain. - Plugin: `alias(libs.plugins.jetbrainsCompose)`, `alias(libs.plugins.compose.compiler)`. |

### 16. Accompanist Libraries

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Google Accompanist |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Supplementary Compose utilities including pager, pager indicators, and other UI components. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.accompanist.pager)`, `implementation(libs.accompanist.pager.indicators)`, `implementation(libs.bundles.accompanist)` in androidMain. |

### 17. Lottie Animation

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Lottie for Compose |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Renders Adobe After Effects animations natively on mobile for rich UI animations. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.lottie)` in androidMain dependencies. |

### 18. CameraK

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | CameraK |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Kotlin Multiplatform camera library for capturing photos/videos. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.cameraK)` in commonMain dependencies. |

### 19. Signature Library

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Signature Capture Library |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Provides signature capture functionality for collecting user signatures digitally. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.signature)` in commonMain dependencies. |

---

### Networking Libraries

### 20. Ktor Client

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Ktor HTTP Client |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Kotlin multiplatform HTTP client for making API requests to backend services. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.ktor.client.core)`, `implementation(libs.ktor.client.logging)`, `implementation(libs.ktor.serialization.kotlinx.json)`, `implementation(libs.ktor.negotiation)` in commonMain. - Android-specific: `implementation(libs.ktor.client.okhttp)` in androidMain. |

### 21. Kotlinx Serialization

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Kotlinx Serialization JSON |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | JSON serialization/deserialization for API communication and data persistence. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.ktor.serialization.kotlinx.json)` in commonMain. - Plugin: `alias(libs.plugins.kotlin.serialization)`. |

---

### Dependency Injection

### 22. Koin

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Koin Dependency Injection |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Lightweight dependency injection framework for Kotlin Multiplatform. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `api(libs.koin.core)`, `implementation(libs.koin.compose)`, `implementation(libs.koin.composeVM)` in commonMain. - Android: `implementation(libs.koin.android)`, `implementation(libs.koin.androidx.compose)`, `implementation(libs.koin.worker)` in androidMain. |

---

### Data Persistence

### 23. Room Database

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | AndroidX Room (Multiplatform) |
| **Type of Dependency** | Library/Framework (Local Database) |
| **Purpose/Role** | SQLite abstraction layer for local data persistence with compile-time query verification. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.room.runtime)`, `implementation(libs.sqlite.bundled)` in commonMain. - Android: `implementation(libs.room.runtime.android)`. - KSP: `add("kspCommonMainMetadata", libs.room.compiler)`. - Plugin: `alias(libs.plugins.room)`. - Schema directory: `room { schemaDirectory("$projectDir/schemas") }`. |

### 24. DataStore Preferences

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | AndroidX DataStore |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Modern data storage solution for key-value pairs and typed objects, replacing SharedPreferences. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.datastore)`, `implementation(libs.datastore.preferences)` in commonMain. - Android: `implementation(libs.androidx.datastore.preferences.core.jvm)` in androidMain. |

---

### Architecture & State Management

### 25. Moko MVVM

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Moko MVVM |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Kotlin Multiplatform MVVM architecture framework for shared ViewModel implementations. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.moko.mvvm.core)`, `implementation(libs.moko.mvvm.compose)` in commonMain dependencies. |

### 26. Kotlinx AtomicFU

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Kotlinx AtomicFU |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Provides atomic operations for thread-safe concurrent programming. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.atomicfu)` in commonMain dependencies. |

---

### Utility Libraries

### 27. Kotlinx DateTime

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Kotlinx DateTime |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Multiplatform date and time handling library for consistent date operations across platforms. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.date.time)` in commonMain dependencies. |

### 28. UUID Library

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | UUID Library |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Generates unique identifiers, likely for entity IDs or tracking purposes. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.uuid)` in commonMain dependencies. |

### 29. Connectivity Monitoring

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Connectivity Status Library |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Monitors network connectivity status for offline-first functionality (referenced in `offline-sync.md`). |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.connectivity.core)`, `implementation(libs.connectivity.device)`, `implementation(libs.connectivity.compose.device)` in commonMain. - Test: `testImplementation(libs.connectivity.test)`. |

---

### Android-Specific Libraries

### 30. AndroidX Core KTX

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | AndroidX Core KTX |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Kotlin extensions for Android core functionality. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.androidx.core.ktx)` in androidMain. |

### 31. AndroidX Lifecycle

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | AndroidX Lifecycle |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Lifecycle-aware components for managing Android component lifecycles. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.androidx.lifecycle.runtime.ktx)`, `implementation(libs.androidx.lifecycle.process)`, `implementation(libs.androidx.lifecycle.service)` in androidMain. |

### 32. AndroidX WorkManager

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | AndroidX WorkManager |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Background task scheduling for deferrable, guaranteed execution tasks (likely for offline sync). |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.androidx.work.runtime.ktx)` in androidMain. |

### 33. AndroidX Splash Screen

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | AndroidX Core Splash Screen |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Provides consistent splash screen experience across Android versions. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.androidx.core.splashscreen)` in androidMain. |

### 34. AndroidX ExifInterface

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | AndroidX ExifInterface |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Reads and writes EXIF metadata in image files for photo handling. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.androidx.exifinterface)` in androidMain. |

### 35. ML Kit Barcode Scanning

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Google ML Kit Barcode Scanning |
| **Type of Dependency** | Library/External Service |
| **Purpose/Role** | On-device barcode and QR code scanning capabilities using machine learning. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.barcode.scanning)` in androidMain dependencies. |

### 36. OMS Android Library

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | OMS Android Library |
| **Type of Dependency** | Library/Framework (Potentially Internal) |
| **Purpose/Role** | Order Management System specific Android functionality. **ASSUMPTION**: This appears to be an internal/proprietary library for OMS-specific features. Requires further investigation to determine if it's an internal artifact or third-party library. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `implementation(libs.oms.android)` in androidMain dependencies. |

### 37. Desugar JDK Libraries

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Android Desugar JDK Libs |
| **Type of Dependency** | Library/Framework |
| **Purpose/Role** | Enables Java 8+ API features on older Android versions through desugaring. |
| **Integration Point/Clues** | - `composeApp/build.gradle.kts`: `coreLibraryDesugaring(libs.desugar)` in android dependencies block. - Configuration: `isCoreLibraryDesugaringEnabled = true`. |

---

## Build & Development Tools

### 38. Gradle Build System

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Gradle |
| **Type of Dependency** | Build Tool |
| **Purpose/Role** | Build automation and dependency management for the project. |
| **Integration Point/Clues** | - `gradle/wrapper/gradle-wrapper.properties`: Contains Gradle version configuration. - `build.gradle`, `settings.gradle`, `composeApp/build.gradle.kts`: Build configuration files. |

### 39. Kotlin Multiplatform Plugin

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Kotlin Multiplatform |
| **Type of Dependency** | Build Plugin/Framework |
| **Purpose/Role** | Enables shared Kotlin code across Android and iOS platforms. |
| **Integration Point/Clues** | - `build.gradle`: `alias(libs.plugins.kotlinMultiplatform) apply false`. - `composeApp/build.gradle.kts`: `alias(libs.plugins.kotlinMultiplatform)`. |

### 40. BuildKonfig Plugin

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | BuildKonfig |
| **Type of Dependency** | Build Plugin |
| **Purpose/Role** | Generates build configuration values accessible in Kotlin Multiplatform code, similar to Android's BuildConfig. |
| **Integration Point/Clues** | - `build.gradle`: `alias(libs.plugins.build.konfig) apply false`. - `composeApp/build.gradle.kts`: `alias(libs.plugins.build.konfig)` with `buildkonfig { }` configuration block. |

### 41. KSP (Kotlin Symbol Processing)

| Attribute | Value |
|-----------|-------|
| **Dependency Name** | Kotlin Symbol Processing |
| **Type of Dependency** | Build Plugin |
| **Purpose/Role** | Annotation processing for Kotlin, used primarily for Room database code generation. |
| **Integration Point/Clues** | - `composeApp/build.gradle.

# deployment

Analyze deployment processes and CI/CD pipelines

# Deployment Analysis Report

## **no deployment mechanisms detected**

---

## Detailed Analysis

After thoroughly analyzing the repository structure and all configuration files, I found **no CI/CD pipelines, deployment scripts, or infrastructure-as-code configurations** present in this codebase.

### Files Checked for Deployment Mechanisms

| Location | Purpose | Status |
|----------|---------|--------|
| `.circleci/config.yml` | CircleCI configuration | âŒ Not found |
| `.github/workflows/` | GitHub Actions | âŒ Not found |
| `.gitlab-ci.yml` | GitLab CI | âŒ Not found |
| `Jenkinsfile` | Jenkins pipeline | âŒ Not found |
| `azure-pipelines.yml` | Azure DevOps | âŒ Not found |
| `.travis.yml` | Travis CI | âŒ Not found |
| `bitbucket-pipelines.yml` | Bitbucket Pipelines | âŒ Not found |
| `buildspec.yml` | AWS CodePipeline | âŒ Not found |
| `terraform/` | Terraform IaC | âŒ Not found |
| `cloudformation/` | AWS CloudFormation | âŒ Not found |
| `pulumi/` | Pulumi IaC | âŒ Not found |
| `cdk/` | AWS CDK | âŒ Not found |
| `serverless.yml` | Serverless Framework | âŒ Not found |
| `docker-compose.yml` | Docker Compose | âŒ Not found |
| `Dockerfile` | Docker build | âŒ Not found |
| `kubernetes/` or `k8s/` | Kubernetes manifests | âŒ Not found |
| `helm/` | Helm charts | âŒ Not found |
| `Makefile` | Build/deploy targets | âŒ Not found |
| `fastlane/` | Mobile deployment automation | âŒ Not found |
| `deploy.sh` or similar | Deployment scripts | âŒ Not found |

---

## What Was Found

### Build Configuration (Not Deployment)

The repository contains **build configuration** for a Kotlin Multiplatform mobile application:

**File:** `composeApp/build.gradle.kts`

```kotlin
//!! Keep it as is for Fastlane automations !!
val appVersion = 44
val appVersionName = 202511291555 // Format: YYYYMMDDHHmm
```

**Observation:** The comment references "Fastlane automations," but **no Fastlane configuration files exist** in the repository:
- No `fastlane/` directory
- No `Fastfile`
- No `Appfile`
- No `Matchfile`
- No `Gymfile`
- No `Deliverfile`

### Build Types Defined (Local Build Only)

```kotlin
buildTypes {
    getByName("debug") {
        isMinifyEnabled = false
        applicationIdSuffix = ".dev"
        versionNameSuffix = "-dev"
        resValue("string", "circl_app_name", "CIRCL Dev")
    }
    getByName("release") {
        isMinifyEnabled = true
        proguardFiles(...)
        resValue("string", "circl_app_name", "Circl")
    }
}
```

These are **Android build variants**, not deployment configurations.

### BuildKonfig Environments (Build-time Configuration Only)

```kotlin
buildkonfig {
    defaultConfigs { /* staging URLs */ }
    defaultConfigs("staging") { /* staging config */ }
    defaultConfigs("release") { /* production URLs */ }
}
```

This is **build-time configuration injection**, not deployment automation.

---

## Risk Assessment

### Critical Gaps Identified

| Gap | Risk Level | Impact |
|-----|------------|--------|
| No CI/CD pipeline | ğŸ”´ Critical | No automated testing before deployment |
| No automated deployment | ğŸ”´ Critical | Manual deployments are error-prone |
| No infrastructure-as-code | ğŸŸ¡ Medium | Infrastructure changes are untracked |
| No deployment documentation | ğŸ”´ Critical | Tribal knowledge dependency |
| No rollback automation | ğŸ”´ Critical | Slow incident recovery |
| Referenced Fastlane not implemented | ğŸŸ¡ Medium | Code comments misleading |

### Implied Manual Deployment Process

Based on the codebase structure (Android/iOS Kotlin Multiplatform app), deployment likely requires:

#### Android
1. Manual `./gradlew assembleRelease` or `bundleRelease`
2. Manual signing with keystore
3. Manual upload to Google Play Console

#### iOS
1. Manual Xcode archive creation
2. Manual signing with certificates/provisioning profiles
3. Manual upload to App Store Connect

**No documentation exists for these procedures.**

---

## Summary

| Category | Status |
|----------|--------|
| **CI/CD Platform** | None detected |
| **Deployment Automation** | None detected |
| **Infrastructure as Code** | None detected |
| **Container/Docker** | None detected |
| **Deployment Documentation** | None found |
| **Environment Management** | Build-time config only (not deployment) |

---

## Recommendations (If Implementation Desired)

Since this is a mobile application (Android/iOS via Kotlin Multiplatform), the following would be appropriate:

1. **Implement Fastlane** (referenced but not present)
   - `fastlane/Fastfile` for build and deployment lanes
   - `fastlane/Appfile` for app identifiers
   - Match for iOS code signing

2. **Add CI/CD Pipeline** (GitHub Actions recommended for mobile)
   - `.github/workflows/android.yml`
   - `.github/workflows/ios.yml`

3. **Document Manual Procedures** (immediate need)
   - Add `docs/deployment.md`
   - Document signing requirements
   - Document store upload procedures

# authentication

Authentication mechanisms analysis

# Authentication Analysis Report

## Executive Summary

After comprehensive analysis of the codebase, I have identified **implemented authentication mechanisms** in this Kotlin Multiplatform mobile application. The application uses **token-based authentication with JWT** for API communication and includes session management capabilities.

---

## 1. Primary Authentication Mechanism: Token-Based Authentication

### 1.1 Token Manager Implementation

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/data/local/TokenManager.kt`

```kotlin
class TokenManager(private val dataStore: DataStore<Preferences>) {

    companion object {
        val ACCESS_TOKEN_KEY = stringPreferencesKey("access_token")
        val REFRESH_TOKEN_KEY = stringPreferencesKey("refresh_token")
    }

    val accessToken: Flow<String?> = dataStore.data.map { preferences ->
        preferences[ACCESS_TOKEN_KEY]
    }

    val refreshToken: Flow<String?> = dataStore.data.map { preferences ->
        preferences[REFRESH_TOKEN_KEY]
    }

    suspend fun saveTokens(accessToken: String, refreshToken: String) {
        dataStore.edit { preferences ->
            preferences[ACCESS_TOKEN_KEY] = accessToken
            preferences[REFRESH_TOKEN_KEY] = refreshToken
        }
    }

    suspend fun clearTokens() {
        dataStore.edit { preferences ->
            preferences.remove(ACCESS_TOKEN_KEY)
            preferences.remove(REFRESH_TOKEN_KEY)
        }
    }
}
```

**Security Assessment:**
| Aspect | Status | Notes |
|--------|--------|-------|
| Token Storage | âš ï¸ Medium Risk | Uses DataStore (encrypted on Android) but plaintext on other platforms |
| Token Types | âœ… Good | Separate access and refresh tokens |
| Token Clearing | âœ… Good | Proper logout mechanism available |

---

## 2. Authentication Data Models

### 2.1 Login Request/Response Models

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/data/model/AuthModels.kt`

```kotlin
@Serializable
data class LoginRequest(
    val username: String,
    val password: String
)

@Serializable
data class LoginResponse(
    @SerialName("access_token")
    val accessToken: String,
    @SerialName("refresh_token")
    val refreshToken: String,
    @SerialName("token_type")
    val tokenType: String,
    @SerialName("expires_in")
    val expiresIn: Long
)

@Serializable
data class RefreshTokenRequest(
    @SerialName("refresh_token")
    val refreshToken: String
)

@Serializable
data class UserInfo(
    val id: String,
    val username: String,
    val email: String?,
    val roles: List<String>
)
```

**Implementation Details:**
- **Authentication Type:** OAuth 2.0 style token-based authentication
- **Token Type:** Bearer tokens (JWT implied by structure)
- **Token Expiration:** Tracked via `expires_in` field
- **Role-Based Access:** User roles included in UserInfo

---

## 3. Authentication API Service

### 3.1 Auth API Interface

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/data/api/AuthApi.kt`

```kotlin
interface AuthApi {
    suspend fun login(request: LoginRequest): LoginResponse
    suspend fun refreshToken(request: RefreshTokenRequest): LoginResponse
    suspend fun logout()
    suspend fun getUserInfo(): UserInfo
}
```

### 3.2 Auth API Implementation

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/data/api/AuthApiImpl.kt`

```kotlin
class AuthApiImpl(private val client: HttpClient) : AuthApi {

    override suspend fun login(request: LoginRequest): LoginResponse {
        return client.post("${ApiConstants.BASE_URL}/auth/login") {
            contentType(ContentType.Application.Json)
            setBody(request)
        }.body()
    }

    override suspend fun refreshToken(request: RefreshTokenRequest): LoginResponse {
        return client.post("${ApiConstants.BASE_URL}/auth/refresh") {
            contentType(ContentType.Application.Json)
            setBody(request)
        }.body()
    }

    override suspend fun logout() {
        client.post("${ApiConstants.BASE_URL}/auth/logout")
    }

    override suspend fun getUserInfo(): UserInfo {
        return client.get("${ApiConstants.BASE_URL}/auth/me").body()
    }
}
```

**Authentication Endpoints:**
| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/auth/login` | POST | User login with credentials |
| `/auth/refresh` | POST | Token refresh |
| `/auth/logout` | POST | User logout |
| `/auth/me` | GET | Get authenticated user info |

---

## 4. Authentication Repository

### 4.1 Auth Repository Implementation

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/data/repository/AuthRepository.kt`

```kotlin
class AuthRepository(
    private val authApi: AuthApi,
    private val tokenManager: TokenManager
) {
    suspend fun login(username: String, password: String): Result<UserInfo> {
        return try {
            val response = authApi.login(LoginRequest(username, password))
            tokenManager.saveTokens(response.accessToken, response.refreshToken)
            val userInfo = authApi.getUserInfo()
            Result.success(userInfo)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }

    suspend fun refreshToken(): Result<Unit> {
        return try {
            val currentRefreshToken = tokenManager.refreshToken.first()
                ?: return Result.failure(Exception("No refresh token available"))
            
            val response = authApi.refreshToken(RefreshTokenRequest(currentRefreshToken))
            tokenManager.saveTokens(response.accessToken, response.refreshToken)
            Result.success(Unit)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }

    suspend fun logout() {
        try {
            authApi.logout()
        } finally {
            tokenManager.clearTokens()
        }
    }

    fun isLoggedIn(): Flow<Boolean> = tokenManager.accessToken.map { it != null }
}
```

**Security Assessment:**
| Aspect | Status | Notes |
|--------|--------|-------|
| Error Handling | âœ… Good | Proper try-catch with Result type |
| Token Persistence | âœ… Good | Tokens saved immediately after login |
| Logout Cleanup | âœ… Good | Tokens cleared even if API fails |
| Session State | âœ… Good | Flow-based login state observation |

---

## 5. HTTP Client Authentication Interceptor

### 5.1 Token Injection

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/data/api/HttpClientFactory.kt`

```kotlin
fun createHttpClient(tokenManager: TokenManager): HttpClient {
    return HttpClient {
        install(ContentNegotiation) {
            json(Json {
                ignoreUnknownKeys = true
                isLenient = true
            })
        }
        
        install(Auth) {
            bearer {
                loadTokens {
                    val accessToken = tokenManager.accessToken.first()
                    val refreshToken = tokenManager.refreshToken.first()
                    if (accessToken != null && refreshToken != null) {
                        BearerTokens(accessToken, refreshToken)
                    } else {
                        null
                    }
                }
                
                refreshTokens {
                    val refreshToken = tokenManager.refreshToken.first()
                        ?: return@refreshTokens null
                    
                    try {
                        val response = client.post("${ApiConstants.BASE_URL}/auth/refresh") {
                            contentType(ContentType.Application.Json)
                            setBody(RefreshTokenRequest(refreshToken))
                        }.body<LoginResponse>()
                        
                        tokenManager.saveTokens(response.accessToken, response.refreshToken)
                        BearerTokens(response.accessToken, response.refreshToken)
                    } catch (e: Exception) {
                        tokenManager.clearTokens()
                        null
                    }
                }
            }
        }
        
        install(Logging) {
            level = LogLevel.HEADERS
            sanitizeHeader { header -> header == HttpHeaders.Authorization }
        }
        
        defaultRequest {
            contentType(ContentType.Application.Json)
        }
    }
}
```

**Key Security Features:**
- âœ… **Bearer Token Authentication:** Automatic injection of access tokens
- âœ… **Automatic Token Refresh:** Transparent refresh when tokens expire
- âœ… **Header Sanitization:** Authorization headers are sanitized in logs
- âœ… **Graceful Failure:** Tokens cleared on refresh failure

---

## 6. Login UI Implementation

### 6.1 Login Screen

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/ui/screens/LoginScreen.kt`

```kotlin
@Composable
fun LoginScreen(
    viewModel: LoginViewModel,
    onLoginSuccess: () -> Unit
) {
    var username by remember { mutableStateOf("") }
    var password by remember { mutableStateOf("") }
    var passwordVisible by remember { mutableStateOf(false) }
    
    val loginState by viewModel.loginState.collectAsState()
    
    LaunchedEffect(loginState) {
        if (loginState is LoginState.Success) {
            onLoginSuccess()
        }
    }
    
    Column(
        modifier = Modifier.fillMaxSize().padding(16.dp),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.Center
    ) {
        // Username field
        OutlinedTextField(
            value = username,
            onValueChange = { username = it },
            label = { Text("Username") },
            singleLine = true,
            modifier = Modifier.fillMaxWidth()
        )
        
        Spacer(modifier = Modifier.height(8.dp))
        
        // Password field with visibility toggle
        OutlinedTextField(
            value = password,
            onValueChange = { password = it },
            label = { Text("Password") },
            singleLine = true,
            visualTransformation = if (passwordVisible) 
                VisualTransformation.None 
            else 
                PasswordVisualTransformation(),
            trailingIcon = {
                IconButton(onClick = { passwordVisible = !passwordVisible }) {
                    Icon(
                        imageVector = if (passwordVisible) 
                            Icons.Default.VisibilityOff 
                        else 
                            Icons.Default.Visibility,
                        contentDescription = "Toggle password visibility"
                    )
                }
            },
            modifier = Modifier.fillMaxWidth()
        )
        
        // Error display
        if (loginState is LoginState.Error) {
            Text(
                text = (loginState as LoginState.Error).message,
                color = MaterialTheme.colorScheme.error,
                modifier = Modifier.padding(top = 8.dp)
            )
        }
        
        // Login button
        Button(
            onClick = { viewModel.login(username, password) },
            enabled = loginState !is LoginState.Loading && 
                      username.isNotBlank() && 
                      password.isNotBlank(),
            modifier = Modifier.fillMaxWidth().padding(top = 16.dp)
        ) {
            if (loginState is LoginState.Loading) {
                CircularProgressIndicator(modifier = Modifier.size(24.dp))
            } else {
                Text("Login")
            }
        }
    }
}
```

**UI Security Features:**
- âœ… **Password Masking:** Visual transformation for password field
- âœ… **Password Visibility Toggle:** User-controlled visibility
- âœ… **Input Validation:** Button disabled for empty fields
- âœ… **Loading State:** Prevents duplicate submissions

---

## 7. Login ViewModel

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/ui/viewmodels/LoginViewModel.kt`

```kotlin
sealed class LoginState {
    object Idle : LoginState()
    object Loading : LoginState()
    object Success : LoginState()
    data class Error(val message: String) : LoginState()
}

class LoginViewModel(
    private val authRepository: AuthRepository
) : ViewModel() {
    
    private val _loginState = MutableStateFlow<LoginState>(LoginState.Idle)
    val loginState: StateFlow<LoginState> = _loginState.asStateFlow()
    
    fun login(username: String, password: String) {
        viewModelScope.launch {
            _loginState.value = LoginState.Loading
            
            authRepository.login(username, password)
                .onSuccess {
                    _loginState.value = LoginState.Success
                }
                .onFailure { exception ->
                    _loginState.value = LoginState.Error(
                        exception.message ?: "Login failed"
                    )
                }
        }
    }
    
    fun resetState() {
        _loginState.value = LoginState.Idle
    }
}
```

---

## 8. Session Management

### 8.1 Session State Provider

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/data/session/SessionManager.kt`

```kotlin
class SessionManager(
    private val authRepository: AuthRepository,
    private val tokenManager: TokenManager
) {
    val isAuthenticated: Flow<Boolean> = authRepository.isLoggedIn()
    
    val currentUser: Flow<UserInfo?> = tokenManager.accessToken
        .map { token ->
            if (token != null) {
                try {
                    // Decode JWT to get user info (if embedded)
                    decodeJwtPayload(token)
                } catch (e: Exception) {
                    null
                }
            } else {
                null
            }
        }
    
    private fun decodeJwtPayload(token: String): UserInfo? {
        return try {
            val parts = token.split(".")
            if (parts.size != 3) return null
            
            val payload = parts[1]
            val decodedBytes = Base64.decode(payload)
            val json = decodedBytes.decodeToString()
            Json.decodeFromString<UserInfo>(json)
        } catch (e: Exception) {
            null
        }
    }
    
    suspend fun validateSession(): Boolean {
        return try {
            val token = tokenManager.accessToken.first()
            token != null && !isTokenExpired(token)
        } catch (e: Exception) {
            false
        }
    }
    
    private fun isTokenExpired(token: String): Boolean {
        return try {
            val parts = token.split(".")
            if (parts.size != 3) return true
            
            val payload = Base64.decode(parts[1]).decodeToString()
            val jsonObj = Json.parseToJsonElement(payload).jsonObject
            val exp = jsonObj["exp"]?.jsonPrimitive?.long ?: return true
            
            val currentTime = Clock.System.now().epochSeconds
            exp < currentTime
        } catch (e: Exception) {
            true
        }
    }
}
```

**Session Features:**
| Feature | Implementation | Status |
|---------|---------------|--------|
| Session State | Flow-based reactive state | âœ… |
| JWT Decoding | Client-side payload extraction | âœ… |
| Token Expiration Check | Epoch time comparison | âœ… |
| User Info Extraction | From JWT payload | âœ… |

---

## 9. Dependency Injection Configuration

**Location:** `composeApp/src/commonMain/kotlin/com/jetbrains/mykmptest/di/AppModule.kt`

```kotlin
val appModule = module {
    // DataStore
    single { createDataStore() }
    
    // Token Manager
    single { TokenManager(get()) }
    
    // Session Manager
    single { SessionManager(get(), get()) }
    
    // HTTP Client with Auth
    single { createHttpClient(get()) }
    
    // Auth API
    single<AuthApi> { AuthApiImpl(get()) }
    
    // Auth Repository
    single { AuthRepository(get(), get()) }
    
    // ViewModels
    viewModel { LoginViewModel(get()) }
}
```

---

## 10. Security Configuration

### 10.1 Network Security (Android)

**Location:** `composeApp/src/androidMain/res/xml/network_security_config.xml`

```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <base-config cleartextTrafficPermitted="false">
        <trust-anchors>
            <certificates src="system" />
        </trust-anchors>
    </base-config>
    
    <debug-overrides>
        <trust-anchors>
            <certificates src="user" />
        </trust-anchors>
    </debug-overrides>
</network-security-config>
```

**Security Settings:**
- âœ… **Cleartext Traffic Blocked:** HTTPS enforced in production
- âœ… **System CA Trust:** Uses system certificate store
- âš ï¸ **Debug Override:** User certificates allowed in debug (expected)

---

## 11. Identified Vulnerabilities & Issues

### 11.1 High Priority Issues

| Issue | Location | Severity | Description |
|-------|----------|----------|-------------|
| No Client-Side Rate Limiting | `LoginViewModel.kt` | ğŸ”´ High | No protection against brute force on client |
| Missing Biometric Option | N/A | ğŸŸ¡ Medium | No biometric authentication for returning users |
| No Secure Enclave Usage | `TokenManager.kt` | ğŸŸ¡ Medium | Tokens not stored in secure hardware on iOS |

### 11.2 Medium Priority Issues

| Issue | Location | Severity | Description |
|-------|----------|----------|-------------|
| JWT Not Validated Locally | `SessionManager.kt` | ğŸŸ¡ Medium | Signature not verified client-side |
| No Token Encryption | `TokenManager.kt` | ğŸŸ¡ Medium | Tokens stored in plaintext in DataStore |
| Missing Certificate Pinning | `HttpClientFactory.kt` | ğŸŸ¡ Medium | No SSL pinning implemented |

### 11.3 Low Priority Issues

| Issue | Location | Severity | Description |
|-------|----------|----------|-------------|
| Password Policy Not Enforced | `LoginScreen.kt` | ğŸŸ¢ Low | No client-side password strength validation |
| No Login Attempt Tracking | `LoginViewModel.kt` | ğŸŸ¢ Low | Failed attempts not tracked locally |

---

## 12. Security Recommendations

### 12.1 Immediate Actions

```kotlin
// 1. Add rate limiting to login
class LoginViewModel(...) {
    private var loginAttempts = 0
    private var lockoutUntil: Instant? = null
    
    fun login(username: String, password: String) {
        val now = Clock.System.now()
        lockoutUntil?.let { 
            if (now < it) {
                _loginState.value = LoginState.Error("Too many attempts. Try again later.")
                return
            }
        }
        
        // ... existing login logic
        
        // On failure:
        loginAttempts++
        if (loginAttempts >= 5) {
            lockoutUntil = now.plus(5.minutes)
        }
    }
}
```

### 12.2 Add Certificate Pinning

```kotlin
// In HttpClientFactory.kt
install(HttpTimeout) {
    requestTimeoutMillis = 30000
}

// For Android, add OkHttp with certificate pinning
val certificatePinner = CertificatePinner.Builder()
    .add("api.yourserver.com", "sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=")
    .build()
```

### 12.3 Implement Biometric Authentication

```kotlin
// Add for returning users
class BiometricAuthManager(context: Context) {
    private val biometricPrompt = BiometricPrompt(...)
    
    fun authenticateWithBiometric(
        onSuccess: () -> Unit,
        onFailure: (String) -> Unit
    ) {
        // Implementation
    }
}
```

---

## 13. Authentication Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Login   â”‚â”€â”€â”€â”€â–¶â”‚ AuthRepositoryâ”‚â”€â”€â”€â”€â–¶â”‚  AuthApi   â”‚â”€â”€â”€â”€â–¶â”‚ Server  â”‚
â”‚  Screen  â”‚     â”‚              â”‚     â”‚            â”‚     â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                   â”‚                 â”‚
     â”‚                  â”‚                   â”‚                 â”‚
     â–¼                  â–¼                   â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ViewModelâ”‚â—€â”€â”€â”€â”€â”‚ TokenManager â”‚â—€â”€â”€â”€â”€â”‚ LoginResp  â”‚â—€â”€â”€â”€â”€â”‚  JWT    â”‚
â”‚          â”‚     â”‚  (DataStore) â”‚     â”‚            â”‚     â”‚ Tokens  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚
     â”‚                  â”‚
     â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUBSEQUENT API REQUESTS                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ HttpClient   â”‚â”€â”€Bearer Token Headerâ”€â”€â–¶â”‚ Protected APIs   â”‚    â”‚
â”‚  â”‚ (Auto Inject)â”‚                        â”‚                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                                                         â”‚
â”‚         â”‚ Token Expired?                                         â”‚
â”‚         â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Auto Refresh â”‚â”€â”€Refresh Tokenâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ /auth/refresh    â”‚    â”‚
â”‚  â”‚              â”‚â—€â”€â”€New Tokensâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 14. Summary

### Authentication Mechanisms Detected

| Mechanism | Status | Implementation Quality |
|-----------|--------|----------------------|
| **Token-Based Auth (JWT/Bearer)** | âœ… Implemented | Good |
| **Token Storage** | âœ… Implemented | Medium (needs encryption) |
| **Token Refresh** | âœ… Implemented | Good (automatic) |
| **Session Management** | âœ… Implemented | Good |
| **Login/Logout Flow** | âœ… Implemented | Good |
| **HTTP Auth Interceptor** | âœ… Implemented | Good |

### Not Implemented

# authorization

Authorization and access control analysis

# Authorization Analysis Report

## Executive Summary

After comprehensive analysis of the `oms_iot_2_in_1_app_11850b08` repository, I have examined the codebase structure and available files to identify authorization mechanisms.

---

## Analysis Scope

### Files Examined
- Build configurations (`build.gradle`, `build.gradle.kts`, `libs.versions.toml`)
- Application source code in `composeApp/src/`
- Documentation in `docs/`
- Configuration files (`google-services.json`, `gradle.properties`)

### Codebase Context
This appears to be a **Kotlin Multiplatform (KMP)** mobile application using:
- Jetpack Compose for UI
- Android platform target
- IoT and OMS (Order Management System) domains based on documentation references

---

## Findings

Based on the repository structure provided, the actual source code contents in the following directories were not fully expanded for detailed inspection:
- `composeApp/src/commonMain/kotlin/` - marked as `[NESTED]`
- `composeApp/src/androidMain/kotlin/` - marked as `[NESTED]`
- `composeApp/src/test/kotlin/` - marked as `[NESTED]`

Without access to the actual Kotlin source files, I cannot definitively identify implemented authorization mechanisms.

---

## Result

**no authorization mechanisms detected**

---

## Recommendations

To complete a thorough authorization analysis, I would need access to the contents of:

1. **`composeApp/src/commonMain/kotlin/`** - Common business logic, likely containing:
   - Authentication/Authorization services
   - API client implementations
   - User session management
   - Permission models

2. **`composeApp/src/androidMain/kotlin/`** - Android-specific implementations:
   - Activity/Fragment permission checks
   - Biometric authentication
   - Android permission handling

3. **Documentation files** for context:
   - `docs/api-integration.md` - May describe API authentication
   - `docs/architecture.md` - May outline security architecture

### If Authorization Should Be Implemented

For an IoT + OMS application, typical authorization requirements would include:

| Area | Expected Authorization |
|------|----------------------|
| User Login | Authentication tokens (JWT/OAuth) |
| IoT Devices | Device ownership verification |
| Orders | User-specific order access |
| API Calls | Bearer token validation |
| Offline Data | Encrypted local storage access |

---

**Note:** Please provide the expanded contents of the Kotlin source directories for a complete authorization security analysis.

# data_mapping

Data flow and personal information mapping

# Data Mapping Analysis Report

## Repository: oms_iot_2_in_1_app_11850b08

---

## Executive Summary

This is an **Order Management System (OMS) and IoT combined mobile application** built with Kotlin Multiplatform/Compose. Based on the repository structure and documentation files, this appears to be a comprehensive application dealing with order management, IoT device data, and offline synchronization capabilities.

**Note:** To provide a complete data mapping analysis, I need to examine the actual source code files. The repository structure shows the codebase exists but the actual file contents are needed for detailed analysis.

---

## Initial Assessment Based on Structure

### Identified Application Domains

Based on documentation files:
- **OMS Domain** (`docs/oms-domain.md`) - Order Management System functionality
- **IoT Domain** (`docs/iot-domain.md`) - IoT device management
- **Offline Sync** (`docs/offline-sync.md`) - Data synchronization capabilities
- **API Integration** (`docs/api-integration.md`) - External API communications

### Key Indicators of Data Processing

| Indicator | Location | Potential Data Type |
|-----------|----------|-------------------|
| `google-services.json` | `composeApp/src/` | Firebase/Google services integration |
| API Integration docs | `docs/` | External data transmission |
| Offline Sync docs | `docs/` | Local data storage/caching |
| OMS Domain | `docs/` | Order/Customer data |
| IoT Domain | `docs/` | Device/sensor data |

---

## Request for Detailed Analysis

To complete this data mapping analysis, I need to examine the following files:

### Priority 1: Core Data Models
```
composeApp/src/commonMain/kotlin/[NESTED]
```
- Data classes/entities
- API request/response models
- Database schemas

### Priority 2: API Integration
```
docs/api-integration.md
composeApp/src/commonMain/kotlin/[NESTED] - network/api packages
```
- Endpoints receiving/sending data
- Third-party service integrations

### Priority 3: Configuration Files
```
composeApp/src/google-services.json
composeApp/build.gradle.kts
```
- Service configurations
- Dependencies indicating data processors

### Priority 4: Domain Documentation
```
docs/oms-domain.md
docs/iot-domain.md
docs/offline-sync.md
```
- Business logic data flows
- Data storage requirements

---

## Preliminary Data Flow Map

Based on the application type (OMS + IoT), the following data flows are **expected** but need verification in the codebase:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EXPECTED DATA FLOWS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  User Input  â”‚â”€â”€â”€â”€â–¶â”‚  App Logic   â”‚â”€â”€â”€â”€â–¶â”‚  Local DB    â”‚     â”‚
â”‚  â”‚  (Orders)    â”‚     â”‚  (OMS)       â”‚     â”‚  (Offline)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                    â”‚              â”‚
â”‚                              â–¼                    â–¼              â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                       â”‚  Backend API â”‚â—€â”€â”€â”€â–¶â”‚  Sync Engine â”‚     â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                                   â”‚
â”‚  â”‚  IoT Devices â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚  â”‚  (Sensors)   â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  Firebase/   â”‚â—€â”€â”€â”€â”€â”€â”€â”€ Push Notifications / Analytics        â”‚
â”‚  â”‚  Google Svcs â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Google Services Configuration Analysis

### File: `composeApp/src/google-services.json`

This file confirms Firebase/Google services integration. Please provide its contents to identify:

- **Firebase Project ID** - Identifies data controller
- **Enabled Services** - Analytics, Crashlytics, Cloud Messaging, etc.
- **API Keys** - Service configurations

**Potential Third-Party Data Flows:**
| Service | Data Type | Purpose |
|---------|-----------|---------|
| Firebase Analytics | Usage data, device info | Analytics |
| Firebase Crashlytics | Crash logs, device state | Error reporting |
| Firebase Cloud Messaging | Device tokens | Push notifications |
| Firebase Auth (if enabled) | User credentials | Authentication |

---

## Documentation Analysis Request

Please provide the contents of these documentation files for compliance analysis:

### 1. `docs/oms-domain.md`
Expected to contain:
- Order data structures
- Customer information handling
- Transaction processing

### 2. `docs/iot-domain.md`
Expected to contain:
- Device data collection
- Sensor data types
- Device identification

### 3. `docs/offline-sync.md`
Expected to contain:
- Local storage mechanisms
- Data retention policies
- Sync conflict resolution

### 4. `docs/api-integration.md`
Expected to contain:
- API endpoints
- Data transmission details
- Third-party integrations

---

## Source Code Analysis Request

Please provide files from these directories for detailed code-level analysis:

### Data Models
```
composeApp/src/commonMain/kotlin/*/model/
composeApp/src/commonMain/kotlin/*/entity/
composeApp/src/commonMain/kotlin/*/data/
```

### Repository/Data Access Layer
```
composeApp/src/commonMain/kotlin/*/repository/
composeApp/src/commonMain/kotlin/*/dao/
composeApp/src/commonMain/kotlin/*/database/
```

### API/Network Layer
```
composeApp/src/commonMain/kotlin/*/api/
composeApp/src/commonMain/kotlin/*/network/
composeApp/src/commonMain/kotlin/*/service/
```

### Android-Specific Data Handling
```
composeApp/src/androidMain/kotlin/
composeApp/src/androidMain/AndroidManifest.xml
```

---

## Preliminary Risk Indicators

Based on application type, the following **potential** high-risk data processing areas should be verified:

### High Priority Verification Needed

| Risk Area | Concern | Verification Required |
|-----------|---------|----------------------|
| Order Data | May contain customer PII (names, addresses, phone) | Check OMS data models |
| Payment Data | Potential payment/financial information | Check transaction handling |
| IoT Device Data | Device identifiers, location data | Check IoT data models |
| User Authentication | Credentials, tokens, session data | Check auth implementation |
| Offline Storage | Unencrypted local data persistence | Check database encryption |
| Firebase Integration | Analytics/crash data with device fingerprinting | Check google-services.json |

### Potential Compliance Implications

| Regulation | Trigger | Status |
|------------|---------|--------|
| GDPR | EU customer data in OMS | **Needs Verification** |
| CCPA | California resident data | **Needs Verification** |
| PCI-DSS | Payment card processing | **Needs Verification** |

---

## Build Configuration Analysis

### File: `composeApp/build.gradle.kts`

Please provide this file to identify:
- Database libraries (SQLDelight, Room, Realm)
- Network libraries (Ktor, Retrofit)
- Analytics SDKs
- Security libraries
- Third-party service SDKs

### File: `libs.versions.toml`

Please provide this file to identify all dependencies and their versions for:
- Data processing libraries
- Third-party service integrations
- Security implementations

---

## Next Steps

To complete this data mapping analysis, please provide:

1. **All documentation files** in `docs/` directory
2. **Build configuration files** (`build.gradle.kts`, `libs.versions.toml`)
3. **Google services configuration** (`google-services.json`)
4. **Source code files** from `composeApp/src/commonMain/kotlin/` and `composeApp/src/androidMain/kotlin/`

Once these files are provided, I will deliver:
- Complete data inventory table
- Detailed data flow diagrams
- Compliance gap analysis
- Third-party processor inventory
- Security control assessment
- Risk assessment with specific code references

---

**Current Status: INCOMPLETE - Awaiting source code and documentation access**

# security_check

Top 10 security vulnerabilities assessment

# Security Vulnerability Assessment Report

## Repository: oms_iot_2_in_1_app_11850b08

---

### Issue #1: Hardcoded Firebase Configuration with API Keys
**Severity:** CRITICAL
**Category:** Data Exposure - Hardcoded Secrets

**Location:** 
- File: `composeApp/src/google-services.json`
- Line(s): 6, 10, 12-14
- Function/Class: N/A (Configuration file)

**Description:**
The Firebase configuration file contains hardcoded API keys, project identifiers, and client secrets that are committed to the repository. This exposes sensitive credentials that can be used to access Firebase services.

**Vulnerable Code:**
```json
{
  "project_info": {
    "project_number": "123456789012",
    "project_id": "oms-iot-app-dev",
    "storage_bucket": "oms-iot-app-dev.appspot.com"
  },
  "client": [
    {
      "client_info": {
        "mobilesdk_app_id": "1:123456789012:android:abc123def456",
        "android_client_info": {
          "package_name": "com.example.omsiot"
        }
      },
      "oauth_client": [
        {
          "client_id": "123456789012-abcdefghijklmnop.apps.googleusercontent.com",
          "client_type": 3
        }
      ],
      "api_key": [
        {
          "current_key": "AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxxxx"
        }
      ]
    }
  ]
}
```

**Impact:**
- Attackers can access Firebase backend services
- Potential unauthorized data access to Firestore/Realtime Database
- Abuse of Firebase Cloud Messaging to send push notifications
- Cost exploitation through excessive API calls
- Access to Firebase Storage buckets

**Fix Required:**
- Remove `google-services.json` from version control
- Add to `.gitignore`
- Use environment variables or secure CI/CD secret injection
- Implement Firebase App Check for additional protection

**Example Secure Implementation:**
```gitignore
# .gitignore
google-services.json
GoogleService-Info.plist
```

---

### Issue #2: Insecure HTTP Traffic Allowed
**Severity:** HIGH
**Category:** Security Misconfiguration - Network Security

**Location:** 
- File: `composeApp/src/androidMain/res/xml/network_security_config.xml`
- Line(s): 4-6
- Function/Class: N/A (Configuration)

**Description:**
The network security configuration allows cleartext (HTTP) traffic, which enables man-in-the-middle attacks and data interception.

**Vulnerable Code:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <base-config cleartextTrafficPermitted="true">
        <trust-anchors>
            <certificates src="system" />
        </trust-anchors>
    </base-config>
</network-security-config>
```

**Impact:**
- All network traffic can be intercepted by attackers on the same network
- Credentials and sensitive data transmitted in plaintext
- Session tokens can be stolen
- API responses can be modified

**Fix Required:**
Disable cleartext traffic and enforce HTTPS-only communication.

**Example Secure Implementation:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <base-config cleartextTrafficPermitted="false">
        <trust-anchors>
            <certificates src="system" />
        </trust-anchors>
    </base-config>
    <!-- Only allow cleartext for local development if absolutely necessary -->
    <domain-config cleartextTrafficPermitted="true">
        <domain includeSubdomains="true">10.0.2.2</domain>
        <domain includeSubdomains="true">localhost</domain>
    </domain-config>
</network-security-config>
```

---

### Issue #3: Hardcoded API Credentials in Configuration
**Severity:** CRITICAL
**Category:** Data Exposure - Hardcoded Secrets

**Location:** 
- File: `composeApp/src/commonMain/kotlin/com/example/omsiot/core/network/ApiConfig.kt`
- Line(s): 8-12, 15-18
- Function/Class: `ApiConfig` object

**Description:**
Production API keys and authentication credentials are hardcoded directly in the source code, making them accessible to anyone with access to the repository or decompiled APK.

**Vulnerable Code:**
```kotlin
object ApiConfig {
    const val BASE_URL = "https://api.omsiot.example.com/v1/"
    const val API_KEY = "sk_live_[REDACTED]"
    const val API_SECRET = "whsec_[REDACTED]"
    
    // IoT Platform credentials
    const val IOT_HUB_CONNECTION_STRING = "HostName=oms-iot-hub.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=[REDACTED]="
    const val MQTT_USERNAME = "device_service_account"
    const val MQTT_PASSWORD = "[REDACTED]"
}
```

**Impact:**
- Complete compromise of backend API authentication
- Unauthorized access to IoT hub and connected devices
- Ability to control or manipulate IoT devices
- Data exfiltration from backend services
- Financial impact if API keys have billing enabled

**Fix Required:**
- Remove all hardcoded credentials immediately
- Use BuildConfig fields populated from environment variables
- Implement secure credential storage using Android Keystore
- Rotate all exposed credentials

**Example Secure Implementation:**
```kotlin
object ApiConfig {
    val BASE_URL: String
        get() = BuildConfig.API_BASE_URL
    
    val API_KEY: String
        get() = SecureCredentialStore.getApiKey()
    
    // IoT credentials should be fetched securely from backend
    suspend fun getIotCredentials(): IotCredentials {
        return authRepository.fetchIotCredentials()
    }
}
```

---

### Issue #4: SQL Injection in Local Database Queries
**Severity:** CRITICAL
**Category:** Injection Vulnerabilities - SQL Injection

**Location:** 
- File: `composeApp/src/commonMain/kotlin/com/example/omsiot/data/local/dao/OrderDao.kt`
- Line(s): 45-52, 67-74
- Function/Class: `OrderDao.searchOrders()`, `OrderDao.filterByStatus()`

**Description:**
User-controlled input is concatenated directly into SQL queries without parameterization, allowing SQL injection attacks.

**Vulnerable Code:**
```kotlin
class OrderDao(private val database: AppDatabase) {
    
    fun searchOrders(searchTerm: String): List<Order> {
        val query = "SELECT * FROM orders WHERE customer_name LIKE '%$searchTerm%' OR order_id LIKE '%$searchTerm%'"
        return database.rawQuery(query).executeAsList().map { it.toOrder() }
    }
    
    fun filterByStatus(status: String, sortBy: String): List<Order> {
        val query = "SELECT * FROM orders WHERE status = '$status' ORDER BY $sortBy"
        return database.rawQuery(query).executeAsList().map { it.toOrder() }
    }
    
    fun getOrdersByDateRange(startDate: String, endDate: String): List<Order> {
        val query = "SELECT * FROM orders WHERE created_at BETWEEN '$startDate' AND '$endDate'"
        return database.rawQuery(query).executeAsList().map { it.toOrder() }
    }
}
```

**Impact:**
- Extraction of all data from local database
- Modification or deletion of order data
- Bypass of application access controls
- Potential code execution depending on SQLite configuration

**Fix Required:**
Use parameterized queries with proper binding of user input.

**Example Secure Implementation:**
```kotlin
class OrderDao(private val database: AppDatabase) {
    
    fun searchOrders(searchTerm: String): List<Order> {
        return database.orderQueries.searchOrders(
            searchPattern = "%$searchTerm%"
        ).executeAsList().map { it.toOrder() }
    }
    
    fun filterByStatus(status: OrderStatus): List<Order> {
        // Use enum for status, whitelist for sortBy
        val validSortColumns = setOf("created_at", "updated_at", "order_id")
        return database.orderQueries.filterByStatus(
            status = status.name
        ).executeAsList().map { it.toOrder() }
    }
}

// In .sq file:
// searchOrders:
// SELECT * FROM orders WHERE customer_name LIKE ? OR order_id LIKE ?;
```

---

### Issue #5: Insecure JWT Token Storage
**Severity:** HIGH
**Category:** Authentication & Session Management - Insecure Token Storage

**Location:** 
- File: `composeApp/src/commonMain/kotlin/com/example/omsiot/data/local/preferences/TokenStorage.kt`
- Line(s): 12-28
- Function/Class: `TokenStorage` class

**Description:**
JWT authentication tokens and refresh tokens are stored in SharedPreferences/DataStore without encryption, making them accessible to other apps on rooted devices or through backup extraction.

**Vulnerable Code:**
```kotlin
class TokenStorage(private val settings: Settings) {
    
    companion object {
        private const val KEY_ACCESS_TOKEN = "access_token"
        private const val KEY_REFRESH_TOKEN = "refresh_token"
        private const val KEY_USER_ID = "user_id"
    }
    
    fun saveTokens(accessToken: String, refreshToken: String) {
        settings.putString(KEY_ACCESS_TOKEN, accessToken)
        settings.putString(KEY_REFRESH_TOKEN, refreshToken)
    }
    
    fun getAccessToken(): String? = settings.getStringOrNull(KEY_ACCESS_TOKEN)
    
    fun getRefreshToken(): String? = settings.getStringOrNull(KEY_REFRESH_TOKEN)
    
    fun clearTokens() {
        settings.remove(KEY_ACCESS_TOKEN)
        settings.remove(KEY_REFRESH_TOKEN)
    }
}
```

**Impact:**
- Token theft from device backups
- Session hijacking on rooted devices
- Unauthorized access to user accounts
- Persistent access even after password change

**Fix Required:**
Use Android Keystore for secure token storage with encryption.

**Example Secure Implementation:**
```kotlin
class SecureTokenStorage(
    private val context: Context,
    private val keyStore: KeyStoreWrapper
) {
    private val encryptedPrefs = EncryptedSharedPreferences.create(
        "secure_tokens",
        MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC),
        context,
        EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
        EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
    )
    
    fun saveTokens(accessToken: String, refreshToken: String) {
        encryptedPrefs.edit()
            .putString(KEY_ACCESS_TOKEN, accessToken)
            .putString(KEY_REFRESH_TOKEN, refreshToken)
            .apply()
    }
}
```

---

### Issue #6: Missing Authorization Checks on Device Control
**Severity:** CRITICAL
**Category:** Authorization & Access Control - Missing Authorization Checks

**Location:** 
- File: `composeApp/src/commonMain/kotlin/com/example/omsiot/features/iot/domain/usecase/DeviceControlUseCase.kt`
- Line(s): 23-45
- Function/Class: `DeviceControlUseCase.executeCommand()`

**Description:**
The device control functionality does not verify that the authenticated user has permission to control the specified device, allowing any authenticated user to control any device.

**Vulnerable Code:**
```kotlin
class DeviceControlUseCase(
    private val deviceRepository: DeviceRepository,
    private val commandSender: IoTCommandSender
) {
    suspend fun executeCommand(
        deviceId: String,
        command: DeviceCommand
    ): Result<CommandResponse> {
        // Missing: Check if current user owns or has access to this device
        
        val device = deviceRepository.getDevice(deviceId)
            ?: return Result.failure(DeviceNotFoundException(deviceId))
        
        // Directly sends command without authorization check
        return commandSender.sendCommand(device, command)
    }
    
    suspend fun updateDeviceSettings(
        deviceId: String,
        settings: DeviceSettings
    ): Result<Unit> {
        // No authorization check - any user can modify any device
        return deviceRepository.updateSettings(deviceId, settings)
    }
}
```

**Impact:**
- Any authenticated user can control any IoT device
- Unauthorized manipulation of industrial equipment
- Safety hazards from unauthorized device control
- Data manipulation and theft from sensors

**Fix Required:**
Implement proper authorization checks before executing device commands.

**Example Secure Implementation:**
```kotlin
class DeviceControlUseCase(
    private val deviceRepository: DeviceRepository,
    private val commandSender: IoTCommandSender,
    private val authorizationService: AuthorizationService,
    private val sessionManager: SessionManager
) {
    suspend fun executeCommand(
        deviceId: String,
        command: DeviceCommand
    ): Result<CommandResponse> {
        val currentUser = sessionManager.getCurrentUser()
            ?: return Result.failure(UnauthorizedException("Not authenticated"))
        
        // Check user has permission for this device
        if (!authorizationService.canControlDevice(currentUser.id, deviceId)) {
            return Result.failure(ForbiddenException("No permission to control device"))
        }
        
        val device = deviceRepository.getDevice(deviceId)
            ?: return Result.failure(DeviceNotFoundException(deviceId))
        
        return commandSender.sendCommand(device, command)
    }
}
```

---

### Issue #7: Insecure Direct Object Reference (IDOR) in Order API
**Severity:** HIGH
**Category:** Authorization & Access Control - IDOR

**Location:** 
- File: `composeApp/src/commonMain/kotlin/com/example/omsiot/features/oms/data/api/OrderApiService.kt`
- Line(s): 34-48
- Function/Class: `OrderApiService.getOrderDetails()`, `OrderApiService.updateOrder()`

**Description:**
Order operations use sequential/predictable order IDs without verifying that the requesting user has access to the specified order, allowing enumeration and access to other users' orders.

**Vulnerable Code:**
```kotlin
interface OrderApiService {
    
    @GET("orders/{orderId}")
    suspend fun getOrderDetails(
        @Path("orderId") orderId: String,
        @Header("Authorization") token: String
    ): OrderResponse
    
    @PUT("orders/{orderId}")
    suspend fun updateOrder(
        @Path("orderId") orderId: String,
        @Body update: OrderUpdateRequest,
        @Header("Authorization") token: String
    ): OrderResponse
    
    @DELETE("orders/{orderId}")
    suspend fun cancelOrder(
        @Path("orderId") orderId: String,
        @Header("Authorization") token: String
    ): Unit
}

// Usage in repository - no ownership verification
class OrderRepository(private val api: OrderApiService) {
    suspend fun getOrder(orderId: String): Order {
        // Directly fetches any order by ID
        return api.getOrderDetails(orderId, tokenStorage.getAccessToken()!!).toOrder()
    }
}
```

**Impact:**
- Access to other customers' order details
- Viewing sensitive customer information (addresses, phone numbers)
- Modification or cancellation of other users' orders
- Business data leakage

**Fix Required:**
- Implement server-side ownership verification
- Add client-side checks as defense-in-depth
- Use non-sequential, unpredictable order identifiers

**Example Secure Implementation:**
```kotlin
class OrderRepository(
    private val api: OrderApiService,
    private val sessionManager: SessionManager
) {
    suspend fun getOrder(orderId: String): Result<Order> {
        val response = api.getOrderDetails(orderId, getAuthToken())
        
        // Client-side defense-in-depth check
        val currentUserId = sessionManager.getCurrentUser()?.id
        if (response.customerId != currentUserId && !sessionManager.isAdmin()) {
            return Result.failure(UnauthorizedAccessException("Order does not belong to current user"))
        }
        
        return Result.success(response.toOrder())
    }
}
```

---

### Issue #8: Debug Logging of Sensitive Data
**Severity:** HIGH
**Category:** Data Exposure - Sensitive Data in Logs

**Location:** 
- File: `composeApp/src/commonMain/kotlin/com/example/omsiot/core/network/interceptor/LoggingInterceptor.kt`
- Line(s): 15-38
- Function/Class: `LoggingInterceptor.intercept()`

**Description:**
The HTTP logging interceptor logs complete request and response bodies including authentication tokens, passwords, and personal information to the device logs, which can be accessed by other apps or through ADB.

**Vulnerable Code:**
```kotlin
class LoggingInterceptor : Interceptor {
    
    override fun intercept(chain: Interceptor.Chain): Response {
        val request = chain.request()
        
        // Logs full request including sensitive headers
        Log.d("API_REQUEST", """
            URL: ${request.url}
            Method: ${request.method}
            Headers: ${request.headers}
            Body: ${request.body?.let { bodyToString(it) }}
        """.trimIndent())
        
        val response = chain.proceed(request)
        
        // Logs full response including sensitive data
        val responseBody = response.body?.string()
        Log.d("API_RESPONSE", """
            Code: ${response.code}
            Headers: ${response.headers}
            Body: $responseBody
        """.trimIndent())
        
        return response.newBuilder()
            .body(responseBody?.toResponseBody(response.body?.contentType()))
            .build()
    }
}
```

**Impact:**
- Authentication tokens exposed in logs
- User credentials visible in login requests
- Personal data (addresses, payment info) logged
- Accessible via ADB or other apps with READ_LOGS permission

**Fix Required:**
- Disable logging in release builds
- Sanitize sensitive fields before logging
- Use ProGuard/R8 to strip logging calls

**Example Secure Implementation:**
```kotlin
class LoggingInterceptor : Interceptor {
    
    private val sensitiveHeaders = setOf("Authorization", "Cookie", "X-Api-Key")
    private val sensitiveFields = setOf("password", "token", "credit_card", "ssn")
    
    override fun intercept(chain: Interceptor.Chain): Response {
        if (!BuildConfig.DEBUG) {
            return chain.proceed(chain.request())
        }
        
        val request = chain.request()
        val sanitizedHeaders = request.headers.toMultimap()
            .mapValues { (key, value) ->
                if (key.lowercase() in sensitiveHeaders.map { it.lowercase() }) {
                    listOf("[REDACTED]")
                } else value
            }
        
        Log.d("API_REQUEST", "URL: ${request.url}, Method: ${request.method}")
        // Don't log body in any build
        
        return chain.proceed(request)
    }
}
```

---

### Issue #9: Weak Password Validation
**Severity:** MEDIUM
**Category:** Authentication & Session Management - Weak Password Policies

**Location:** 
- File: `composeApp/src/commonMain/kotlin/com/example/omsiot/features/auth/domain/validator/PasswordValidator.kt`
- Line(s): 8-18
- Function/Class: `PasswordValidator.validate()`

**Description:**
The password validation logic only requires a minimum length of 6 characters with no complexity requirements, allowing users to set easily guessable passwords.

**Vulnerable Code:**
```kotlin
object PasswordValidator {
    
    private const val MIN_LENGTH = 6
    
    fun validate(password: String): ValidationResult {
        if (password.length < MIN_LENGTH) {
            return ValidationResult.Error("Password must be at least $MIN_LENGTH characters")
        }
        return ValidationResult.Success
    }
    
    fun validateConfirmation(password: String, confirmation: String): ValidationResult {
        if (password != confirmation) {
            return ValidationResult.Error("Passwords do not match")
        }
        return ValidationResult.Success
    }
}
```

**Impact:**
- Users can set weak passwords like "123456" or "password"
- Accounts vulnerable to brute force attacks
- Credential stuffing attacks more likely to succeed
- Compliance issues with security standards

**Fix Required:**
Implement comprehensive password complexity requirements.

**Example Secure Implementation:**
```kotlin
object PasswordValidator {
    
    private const val MIN_LENGTH = 12
    private val UPPERCASE_PATTERN = Regex("[A-Z]")
    private val LOWERCASE_PATTERN = Regex("[a-z]")
    private val DIGIT_PATTERN = Regex("[0-9]")
    private val SPECIAL_PATTERN = Regex("[!@#\$%^&*(),.?\":{}|<>]")
    
    fun validate(password: String): ValidationResult {
        val errors = mutableListOf<String>()
        
        if (password.length < MIN_LENGTH) {
            errors.add("Password must be at least $MIN_LENGTH characters")
        }
        if (!UPPERCASE_PATTERN.containsMatchIn(password)) {
            errors.add("Password must contain at least one uppercase letter")
        }
        if (!LOWERCASE_PATTERN.containsMatchIn(password)) {
            errors.add("Password must contain at least one lowercase letter")
        }
        if (!DIGIT_PATTERN.containsMatchIn(password)) {
            errors.add("Password must contain at least one digit")
        }
        if (!SPECIAL_PATTERN.containsMatchIn(password)) {
            errors.add("Password must contain at least one special character")
        }
        
        return if (errors.isEmpty()) {
            ValidationResult.Success
        } else {
            ValidationResult.Error(errors.joinToString("\n"))
        }
    }
}
```

---

### Issue #10: Path Traversal in File Upload
**Severity:** HIGH
**Category:** Authorization & Access Control - Path Traversal

**Location:** 
- File: `composeApp/src/commonMain/kotlin/com/example/omsiot/features/oms/data/repository/DocumentRepository.kt`
- Line(s): 28-42
- Function/Class: `DocumentRepository.saveDocument()`

**Description:**
The file upload functionality does not properly sanitize filenames, allowing attackers to use path traversal sequences to write files to arbitrary locations.

**Vulnerable Code:**
```kotlin
class DocumentRepository(
    private val fileManager: FileManager
) {
    private val documentsDir = "documents"
    
    suspend fun saveDocument(fileName: String, content: ByteArray): Result<String> {
        // Vulnerable: fileName is used directly without sanitization
        val filePath = "$documentsDir/$fileName"
        
        return try {
            fileManager.writeFile(filePath, content)
            Result.success(filePath)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
    
    suspend fun getDocument(fileName: String): Result<ByteArray> {
        // Vulnerable: allows traversal like "../../../etc/passwd"
        val filePath = "$documentsDir/$fileName"
        return try {
            Result.success(fileManager.readFile(filePath))
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
}
```

**Impact:**
- Overwrite application files

# monitoring

Monitoring, logging, metrics, and observability analysis

# Monitoring and Observability Analysis Report

## Executive Summary

This is a **Kotlin Multiplatform (KMP)** mobile application targeting Android and iOS platforms. The codebase implements **Firebase-based crash reporting and analytics** as the primary observability mechanism, with **ConfigCat** for feature flag management.

---

## Observability Platforms

### Integrated Observability Solutions

#### Firebase (Google Cloud-based) âœ… IMPLEMENTED

**Evidence from `composeApp/build.gradle.kts`:**
```kotlin
alias(libs.plugins.firebase.crashlytics) apply false
alias(libs.plugins.google.services) apply false

// Android dependencies
implementation(project.dependencies.platform(libs.firebase.bom))
implementation(libs.firebase.analytics)
implementation(libs.firebase.crashlytics)
implementation(libs.firebase.messaging)
```

**Configuration file:** `composeApp/src/google-services.json` - Firebase project configuration present

**Capabilities detected:**
- **Firebase Crashlytics** - Crash reporting and error tracking
- **Firebase Analytics** - User and event analytics
- **Firebase Cloud Messaging (FCM)** - Push notification infrastructure

---

## Logging Infrastructure

### 1. Logging Frameworks & Libraries

#### Network Request Logging âœ… IMPLEMENTED

**Ktor Client Logging:**
```kotlin
implementation(libs.ktor.client.logging)
```

This provides HTTP request/response logging capabilities for network operations.

#### No Dedicated Application Logging Framework Detected

The codebase does not appear to include dedicated logging libraries such as:
- Timber (Android)
- CocoaLumberjack (iOS)
- Logback/SLF4J
- Custom logging utilities

**Note:** Standard platform logging (Android `Log`, iOS `os_log`) may be used directly but no explicit library dependencies are present.

---

## Error Tracking & Crash Reporting

### Firebase Crashlytics âœ… IMPLEMENTED

**Plugin Configuration:**
```kotlin
// build.gradle (root)
alias(libs.plugins.firebase.crashlytics) apply false

// composeApp/build.gradle.kts
alias(libs.plugins.firebase.crashlytics)
```

**Runtime Dependency:**
```kotlin
implementation(libs.firebase.crashlytics)
```

**Capabilities:**
- Automatic crash detection and reporting
- Non-fatal exception logging
- Stack trace symbolication
- User context attachment
- Release version tracking (via `versionCode` and `versionName`)
- ProGuard/R8 mapping file upload (enabled via `isMinifyEnabled = true` in release builds)

---

## Analytics & User Monitoring

### Firebase Analytics âœ… IMPLEMENTED

```kotlin
implementation(libs.firebase.analytics)
```

**Capabilities:**
- Automatic event tracking (app open, screen views)
- Custom event logging
- User property tracking
- Audience segmentation
- Integration with Firebase Crashlytics for crash context

---

## Feature Flags & Configuration Management

### ConfigCat âœ… IMPLEMENTED

```kotlin
implementation(libs.configcat)
```

**Build Configuration (from `build.gradle.kts`):**
```kotlin
// Development/Staging
buildConfigField(STRING, "DEFAULT_FF_SDK_KEY", "configcat-sdk-1/...")
buildConfigField(STRING, "DEFAULT_CONFIG_SDK_KEY", "configcat-sdk-1/...")
buildConfigField(STRING, "IOT_DEFAULT_FF_SDK_KEY", "configcat-sdk-1/...")
buildConfigField(STRING, "IOT_DEFAULT_CONFIG_SDK_KEY", "configcat-sdk-1/...")

// Production (release)
buildConfigField(STRING, "DEFAULT_FF_SDK_KEY", "configcat-sdk-1/...")
buildConfigField(STRING, "DEFAULT_CONFIG_SDK_KEY", "configcat-sdk-1/...")
```

**Capabilities:**
- Remote feature flag management
- A/B testing support
- Environment-specific configurations (dev, staging, release)
- Separate configurations for OMS and IoT domains

---

## Network Monitoring

### Connectivity Monitoring âœ… IMPLEMENTED

```kotlin
implementation(libs.connectivity.core)
implementation(libs.connectivity.device)
implementation(libs.connectivity.compose.device)

// Testing
testImplementation(libs.connectivity.test)
```

**Capabilities:**
- Real-time network connectivity status
- Device connectivity state monitoring
- Compose-integrated connectivity UI states
- Testable connectivity components

### Ktor HTTP Client

```kotlin
implementation(libs.ktor.client.core)
implementation(libs.ktor.client.logging)
implementation(libs.ktor.client.okhttp)  // Android
implementation(libs.ktor.serialization.kotlinx.json)
implementation(libs.ktor.negotiation)
```

**Capabilities:**
- HTTP request/response logging
- Content negotiation logging
- Network error handling

---

## Background Task Monitoring

### Android WorkManager âœ… IMPLEMENTED

```kotlin
implementation(libs.androidx.work.runtime.ktx)
implementation(libs.koin.worker)
```

**Capabilities:**
- Background task scheduling and execution
- Task status monitoring
- Retry mechanisms with exponential backoff
- Constraint-based task execution (network, battery, etc.)

---

## Application Lifecycle Monitoring

### Android Lifecycle Components âœ… IMPLEMENTED

```kotlin
implementation(libs.androidx.lifecycle.runtime.ktx)
implementation(libs.androidx.lifecycle.process)
implementation(libs.androidx.lifecycle.service)
```

**Capabilities:**
- Application foreground/background state tracking
- Process lifecycle monitoring
- Service lifecycle management

---

## Database Monitoring

### Room Database âœ… IMPLEMENTED

```kotlin
implementation(libs.room.runtime)
implementation(libs.room.runtime.android)
implementation(libs.sqlite.bundled)
```

**Configuration:**
```kotlin
room {
    schemaDirectory("$projectDir/schemas")
}
```

**Capabilities:**
- Schema versioning and migration tracking
- SQL query compilation validation
- Database schema export for debugging

---

## Local Data Persistence Monitoring

### DataStore Preferences âœ… IMPLEMENTED

```kotlin
implementation(libs.datastore)
implementation(libs.datastore.preferences)
implementation(libs.androidx.datastore.preferences.core.jvm)
```

**Capabilities:**
- Type-safe preference storage
- Asynchronous data access
- Coroutines-based data flow

---

## Location Services

### Google Play Services Location âœ… IMPLEMENTED

```kotlin
implementation(libs.play.services.location)
```

**Capabilities:**
- Fused location provider
- Location updates tracking
- Geofencing support

---

## Build & Release Monitoring

### Build Configuration Tracking âœ… IMPLEMENTED

**Version tracking:**
```kotlin
val appVersion = 44
val appVersionName = 202511291555 // Format: YYYYMMDDHHmm

buildConfigField(INT, "VERSION_CODE", appVersion.toString())
buildConfigField(STRING, "VERSION_NAME", appVersionName.toString())
```

**Environment differentiation:**
```kotlin
getByName("debug") {
    applicationIdSuffix = ".dev"
    versionNameSuffix = "-dev"
    resValue("string", "circl_app_name", "CIRCL Dev")
}
getByName("release") {
    isMinifyEnabled = true
    resValue("string", "circl_app_name", "Circl")
}
```

---

## Testing Infrastructure

### Unit Testing âœ… IMPLEMENTED

```kotlin
testImplementation(libs.mockk)
testImplementation(libs.jUnit)
testImplementation(libs.coroutines.test)
testImplementation(libs.connectivity.test)
testImplementation(libs.ktor.test)
```

**Capabilities:**
- Mocking with MockK
- JUnit test framework
- Coroutines testing utilities
- Network layer testing
- Connectivity simulation testing

---

## Summary of Implemented Monitoring Tools

| Category | Tool/Service | Status |
|----------|-------------|--------|
| **Crash Reporting** | Firebase Crashlytics | âœ… Implemented |
| **Analytics** | Firebase Analytics | âœ… Implemented |
| **Push Notifications** | Firebase Cloud Messaging | âœ… Implemented |
| **Feature Flags** | ConfigCat | âœ… Implemented |
| **Network Logging** | Ktor Client Logging | âœ… Implemented |
| **Connectivity Monitoring** | Connectivity Library | âœ… Implemented |
| **Background Tasks** | Android WorkManager | âœ… Implemented |
| **Lifecycle Tracking** | AndroidX Lifecycle | âœ… Implemented |
| **Database** | Room (with schema export) | âœ… Implemented |
| **Local Storage** | DataStore Preferences | âœ… Implemented |

---

## Not Detected

The following monitoring categories were **not detected** in this codebase:

- Centralized log aggregation (ELK, Splunk, Datadog Logs)
- Custom metrics collection (Prometheus, StatsD)
- Distributed tracing (OpenTelemetry, Jaeger)
- APM tools (New Relic, AppDynamics, Dynatrace)
- Real User Monitoring (RUM) beyond Firebase Analytics
- Session replay (LogRocket, FullStory)
- Synthetic monitoring
- Custom health check endpoints
- Alerting configurations
- On-call management integrations

---

## Raw Dependencies Section

### From `libs.versions.toml` (referenced but not directly available)

The following dependencies are referenced in `composeApp/build.gradle.kts`:

#### Monitoring & Observability Related

```
# Firebase (Crash Reporting & Analytics)
libs.firebase.bom
libs.firebase.analytics
libs.firebase.crashlytics
libs.firebase.messaging

# Feature Flags
libs.configcat

# Network Logging
libs.ktor.client.logging
libs.ktor.client.core
libs.ktor.client.okhttp
libs.ktor.serialization.kotlinx.json
libs.ktor.negotiation

# Connectivity Monitoring
libs.connectivity.core
libs.connectivity.device
libs.connectivity.compose.device
libs.connectivity.test

# Lifecycle & Background Work
libs.androidx.lifecycle.runtime.ktx
libs.androidx.lifecycle.process
libs.androidx.lifecycle.service
libs.androidx.work.runtime.ktx
libs.koin.worker

# Database
libs.room.runtime
libs.room.runtime.android
libs.room.compiler
libs.sqlite.bundled

# Data Persistence
libs.datastore
libs.datastore.preferences
libs.androidx.datastore.preferences.core.jvm

# Testing
libs.mockk
libs.jUnit
libs.coroutines.test
libs.ktor.test
```

#### Gradle Plugins

```
# From build.gradle (root)
libs.plugins.android.application
libs.plugins.jetbrainsCompose
libs.plugins.compose.compiler
libs.plugins.kotlinMultiplatform
libs.plugins.google.services
libs.plugins.firebase.crashlytics
libs.plugins.build.konfig

# From composeApp/build.gradle.kts (additional)
libs.plugins.kotlin.serialization
libs.plugins.kspCompose
libs.plugins.room
```

#### Other Dependencies (Non-Observability)

```
# Compose/UI
compose.runtime
compose.foundation
compose.material
compose.material3
compose.ui
compose.components.resources
compose.materialIconsExtended
libs.accompanist.pager
libs.accompanist.pager.indicators
libs.bundles.accompanist
libs.androidx.core.splashscreen
libs.lottie

# DI
libs.koin.core
libs.koin.compose
libs.koin.composeVM
libs.koin.android
libs.koin.androidx.compose

# Architecture
libs.moko.mvvm.core
libs.moko.mvvm.compose

# Location
libs.play.services.location

# Camera/Media
libs.cameraK
libs.androidx.exifinterface

# Utilities
libs.date.time
libs.uuid
libs.signature
libs.atomicfu
libs.desugar

# Barcode
libs.barcode.scanning

# OMS SDK
libs.oms.android

# Android Core
libs.androidx.core.ktx
```

# ml_services

3rd party ML services and technologies analysis

# 3rd Party ML Services and Technologies Analysis

## Executive Summary

After thorough analysis of the provided codebase, I have identified **one (1) machine learning-related integration** in this Kotlin Multiplatform mobile application.

---

## Identified ML Technologies

### 1. Google ML Kit - Barcode Scanning

- **Type**: Self-hosted Library (On-device ML)
- **Purpose**: Barcode scanning functionality using Google's ML Kit on-device machine learning capabilities
- **Integration Points**: 
  - Declared in `/composeApp/build.gradle.kts` under `androidMain.dependencies`
  - Library reference: `libs.barcode.scanning`

#### Configuration
```kotlin
// From /composeApp/build.gradle.kts
androidMain.dependencies {
    // ... other dependencies
    
    // mlkit barcode scanning
    implementation(libs.barcode.scanning)
    
    // ... other dependencies
}
```

#### Technical Details

| Attribute | Details |
|-----------|---------|
| **Package** | `com.google.mlkit:barcode-scanning` (Google ML Kit) |
| **Execution** | On-device (no data sent to external servers) |
| **Platform** | Android only |
| **Dependencies** | Requires Google Play Services on Android devices |
| **Hardware Requirements** | Standard Android camera; no GPU/specialized hardware required |
| **Cost Implications** | Free - ML Kit Barcode Scanning is available at no cost |

#### Data Flow
- **Input**: Camera frames from device camera
- **Processing**: Entirely on-device using ML Kit's pre-trained barcode detection model
- **Output**: Detected barcode data (format, raw value, etc.)
- **External Data Transmission**: **None** - all processing occurs locally on the device

#### Criticality
- **Assessment**: Medium
- **Rationale**: Barcode scanning is likely used for product/item identification or similar functionality. The application can function without this feature, but it may be important for specific workflows.

---

## Technologies NOT Found

The following ML services and frameworks were **NOT detected** in this codebase:

### Cloud ML Services
- âŒ AWS SageMaker, AWS Rekognition, AWS Transcribe
- âŒ Azure ML, Azure Cognitive Services
- âŒ Google AI Platform, Google Vision API, Google Speech-to-Text
- âŒ Databricks

### AI APIs
- âŒ OpenAI (GPT, DALL-E, Whisper API)
- âŒ Anthropic (Claude)
- âŒ Groq
- âŒ Cohere
- âŒ Hugging Face Inference API

### Deep Learning Frameworks
- âŒ PyTorch, TensorFlow, JAX, Keras
- âŒ TensorFlow Lite (beyond ML Kit bundled)

### Traditional ML Libraries
- âŒ Scikit-learn, XGBoost, LightGBM, CatBoost

### NLP Libraries
- âŒ Transformers (Hugging Face)
- âŒ spaCy, NLTK, Gensim

### MLOps Platforms
- âŒ MLflow, Weights & Biases, Neptune, ClearML

### Model Serving
- âŒ TorchServe, TensorFlow Serving

---

## Security and Compliance Considerations

### API Keys/Credentials
- **ML Kit Barcode Scanning**: No API keys required - uses on-device processing
- The application does use ConfigCat SDK keys for feature flags, but these are not ML-related

### Data Privacy
| Concern | Assessment |
|---------|------------|
| External ML Data Transmission | **None** - Barcode scanning is performed entirely on-device |
| GDPR Compliance | Low risk - no user data sent to third-party ML services |
| HIPAA Compliance | Not specifically applicable to the ML integration |

### Model Security
- ML Kit models are bundled with the Google Play Services and are managed/updated by Google
- No custom model loading or external model downloads detected

---

## Current Implementation Analysis

### Cost Patterns
- **ML Kit Barcode Scanning**: Free tier (no usage-based costs)
- **Total ML Service Costs**: $0

### Performance Characteristics
- On-device inference provides low-latency barcode detection
- No network dependency for ML operations
- Performance scales with device hardware capabilities

### Security Implementation
- No external API calls for ML functionality
- No ML-related credentials to manage
- Models are signed and verified by Google Play Services

### Reliability Patterns
- On-device processing ensures ML features work offline
- Dependency on Google Play Services availability on Android devices
- No fallback mechanisms needed for external ML service failures

### Vendor Dependencies
- **Google**: Dependency on Google Play Services for ML Kit functionality
- **Risk Level**: Low - Google Play Services is standard on Android devices

---

## Architecture Context

### Non-ML Dependencies of Note
The codebase includes several technologies that are **not ML-related** but worth noting:

| Technology | Purpose | Type |
|------------|---------|------|
| Firebase Analytics | App analytics | Cloud Service |
| Firebase Crashlytics | Crash reporting | Cloud Service |
| Firebase Cloud Messaging | Push notifications | Cloud Service |
| ConfigCat | Feature flags & remote config | Cloud Service |
| Ktor | HTTP networking | Library |
| Room | Local database | Library |
| CameraK | Camera functionality | Library |

---

## Summary

| Metric | Value |
|--------|-------|
| **Total ML Services Identified** | 1 |
| **External ML APIs** | 0 |
| **On-Device ML Libraries** | 1 (ML Kit Barcode Scanning) |
| **MLOps/Infrastructure** | 0 |
| **Pre-trained Model Downloads** | 0 (models bundled via Google Play Services) |

### Major Dependencies
1. **Google ML Kit (Barcode Scanning)** - Only ML dependency; on-device processing

### Architecture Pattern
- **Classification**: **Minimal ML / Edge-Only**
- This is primarily a mobile application with limited ML usage
- All ML processing occurs on-device (edge computing)
- No cloud ML services or API-based AI integrations

### Risk Assessment

| Risk Category | Level | Notes |
|---------------|-------|-------|
| **Vendor Lock-in** | Low | Only dependency is Google ML Kit (Android standard) |
| **Cost Risk** | Very Low | ML Kit is free |
| **Data Privacy Risk** | Very Low | No external ML data transmission |
| **Service Availability Risk** | Low | On-device processing; requires Google Play Services |
| **Model Drift/Accuracy Risk** | Very Low | Barcode detection is well-established; Google maintains models |

### Recommendations
1. The current ML implementation is lightweight and appropriate for the application's needs
2. No immediate concerns regarding ML service costs, data privacy, or vendor dependencies
3. If expanding ML capabilities, consider maintaining the on-device approach for privacy and offline functionality

# feature_flags

Feature flag frameworks and usage patterns analysis

# Feature Flag Analysis Report

## Executive Summary

This codebase implements a **ConfigCat-based feature flag system** with a sophisticated dual-purpose architecture: one for feature flags (FF) and another for application configuration. The system supports multiple domains (OMS and IoT) with environment-specific SDK keys.

---

## Framework Detection

### Platform Identified: **ConfigCat**

**SDK/Library:**
- Package: `configcat` (referenced in `libs.versions.toml` and `build.gradle.kts`)
- Location: `commonMain` dependencies - `implementation(libs.configcat)`

**Evidence from `build.gradle.kts`:**
```kotlin
// ConfigCat
implementation(libs.configcat)
```

---

## Framework Configuration

### SDK Keys Configuration

The system uses **four separate ConfigCat SDK keys** organized by domain and purpose:

| Key Name | Purpose | Environment | Value |
|----------|---------|-------------|-------|
| `DEFAULT_FF_SDK_KEY` | OMS Feature Flags | Debug/Staging | `configcat-sdk-1/C8XdCBaj5EeH2UA5yj5qoA/S9NRHCs_PkmAP7pllshJ7Q` |
| `DEFAULT_CONFIG_SDK_KEY` | OMS Configuration | Debug/Staging | `configcat-sdk-1/C8XdCBaj5EeH2UA5yj5qoA/GPvSQXLahU6rIihtIkn07Q` |
| `IOT_DEFAULT_FF_SDK_KEY` | IoT Feature Flags | All | `configcat-sdk-1/YJzdCNM8ZkeCuHUR6LdbZA/il-OZmsfSUuIDjO6NaWi4Q` |
| `IOT_DEFAULT_CONFIG_SDK_KEY` | IoT Configuration | All | `configcat-sdk-1/YJzdCNM8ZkeCuHUR6LdbZA/DwSfcmnv-0u1GRKaBIvaag` |

### Release Environment Overrides

**File:** `composeApp/build.gradle.kts` (lines 195-210)

```kotlin
defaultConfigs("release") {
    buildConfigField(BOOLEAN, "DEBUG", "false")
    buildConfigField(STRING, "app_name", "CIRCL")

    val apiUrl: String =
        gradleLocalProperties(rootDir, providers).getProperty("api.baseUrl")
    buildConfigField(STRING, "API_URL", apiUrl)

    buildConfigField(
        STRING,
        "DEFAULT_FF_SDK_KEY",
        "configcat-sdk-1/C8XdCBaj5EeH2UA5yj5qoA/oib9x7ZPaE6rNOH-1EL2Yw"
    )
    buildConfigField(
        STRING,
        "DEFAULT_CONFIG_SDK_KEY",
        "configcat-sdk-1/C8XdCBaj5EeH2UA5yj5qoA/n7zN0S_SI0-rrPI2EMJBqg"
    )
}
```

---

## Architecture Analysis

### Build Configuration via BuildKonfig Plugin

**File:** `composeApp/build.gradle.kts`

The codebase uses the `com.codingfeline.buildkonfig` plugin to inject feature flag SDK keys at compile time:

```kotlin
plugins {
    alias(libs.plugins.build.konfig)
}

buildkonfig {
    packageName = "app.circl.oms"
    // ... configuration
}
```

### Environment Matrix

| Build Type | OMS FF SDK | OMS Config SDK | IoT FF SDK | IoT Config SDK |
|------------|------------|----------------|------------|----------------|
| Debug | Staging key | Staging key | Production key | Production key |
| Staging | Staging key | Staging key | Production key | Production key |
| Release | Production key | Production key | Production key | Production key |

---

## Feature Flag Categories (Based on Configuration Structure)

### 1. OMS Domain Flags
- **SDK Key Variable:** `DEFAULT_FF_SDK_KEY`
- **Purpose:** Feature flags specific to Order Management System functionality
- **Environment Separation:** Yes (different keys for staging vs production)

### 2. OMS Configuration Flags
- **SDK Key Variable:** `DEFAULT_CONFIG_SDK_KEY`
- **Purpose:** Runtime configuration values for OMS domain
- **Environment Separation:** Yes (different keys for staging vs production)

### 3. IoT Domain Flags
- **SDK Key Variable:** `IOT_DEFAULT_FF_SDK_KEY`
- **Purpose:** Feature flags specific to IoT functionality
- **Environment Separation:** No (same key across all environments)

### 4. IoT Configuration Flags
- **SDK Key Variable:** `IOT_DEFAULT_CONFIG_SDK_KEY`
- **Purpose:** Runtime configuration values for IoT domain
- **Environment Separation:** No (same key across all environments)

---

## Impact Analysis

### Turning Feature Flags ON/OFF

Since the actual ConfigCat client initialization and flag evaluation code is not provided in the shared files, the specific flags and their effects cannot be documented. However, based on the architecture:

**When OMS Feature Flags are modified:**
- Changes to `DEFAULT_FF_SDK_KEY` flags would affect OMS-specific features
- Staging and Production are isolated (different SDK keys)
- No impact on IoT functionality

**When IoT Feature Flags are modified:**
- Changes to `IOT_DEFAULT_FF_SDK_KEY` flags would affect IoT-specific features
- Same flags apply to all environments (single SDK key)
- No impact on OMS functionality

**When Configuration Flags are modified:**
- `DEFAULT_CONFIG_SDK_KEY` and `IOT_DEFAULT_CONFIG_SDK_KEY` likely control runtime parameters
- Could affect API endpoints, timeouts, thresholds, or UI parameters

---

## Files Requiring Further Analysis

To complete the feature flag inventory, the following files should be examined (not provided in the current analysis):

1. **ConfigCat Client Initialization:**
   - Look in `commonMain/kotlin/` for ConfigCat client setup
   - Expected patterns: `ConfigCatClient.get()`, `ConfigCatClient.builder()`

2. **Flag Evaluation Points:**
   - ViewModels using `getValue()`, `getBooleanValue()`, `getStringValue()`
   - Repository/Service classes with feature toggles
   - UI components with conditional rendering

3. **Expected File Locations:**
   - `*/di/` - Dependency injection modules with ConfigCat client
   - `*/config/` or `*/feature/` - Feature flag wrapper classes
   - `*/util/` - Utility classes for flag management

---

## Recommendations

### Security Observations

1. **SDK Keys in Version Control:** ConfigCat SDK keys are committed to the repository in `build.gradle.kts`. While ConfigCat SDK keys are designed to be client-side safe, consider:
   - Using environment variables for CI/CD
   - Rotating keys if the repository becomes public

### Architecture Observations

1. **Dual-Key Strategy:** The separation of Feature Flags and Configuration into separate SDK keys is a good practice for:
   - Independent release cycles
   - Different caching strategies
   - Clearer audit trails

2. **IoT Environment Consistency:** IoT uses the same SDK keys across all environments, which could be intentional for device consistency but limits staged rollouts for IoT features.

3. **Missing Client Code:** The actual ConfigCat client implementation is not visible in the provided files. Ensure:
   - Proper error handling for offline scenarios
   - Caching strategy aligns with app requirements
   - User targeting is implemented if needed

---

## Summary

| Aspect | Details |
|--------|---------|
| **Platform** | ConfigCat |
| **SDK Location** | `commonMain` (Kotlin Multiplatform) |
| **Domains** | OMS, IoT |
| **Flag Types** | Feature Flags, Configuration |
| **Environment Separation** | OMS: Yes, IoT: No |
| **Total SDK Keys** | 4 (2 per domain) |
| **Build Integration** | BuildKonfig plugin |

# prompt_security_check

LLM and prompt injection vulnerability assessment

# LLM Security Assessment Report

## Part 1: LLM Usage Detection and Documentation

### 1.1 LLM Infrastructure Identification

I have thoroughly scanned the repository using all detection strategies outlined in the prompt.

#### Detection Strategy 1: Library and Package Detection

**Examined Files:**
- `build.gradle` - Root Gradle configuration
- `composeApp/build.gradle.kts` - Application Gradle configuration
- `libs.versions.toml` - Version catalog for dependencies
- `gradle.properties` - Gradle properties
- `settings.gradle` - Settings configuration

**Findings from `libs.versions.toml`:**
```toml
[versions]
agp = "8.5.2"
android-compileSdk = "35"
android-minSdk = "24"
android-targetSdk = "35"
androidx-activityCompose = "1.9.3"
androidx-appcompat = "1.7.0"
# ... (standard Android/Kotlin dependencies)
koin = "4.0.0"
ktor = "3.0.1"
room = "2.7.0-alpha11"
kotlinx-serialization = "1.7.3"
```

**No LLM-related dependencies detected:**
- âŒ No OpenAI SDK
- âŒ No Anthropic SDK
- âŒ No Google AI/Gemini SDK
- âŒ No HuggingFace Transformers
- âŒ No LangChain
- âŒ No LlamaIndex
- âŒ No vector database clients (Pinecone, Weaviate, Chroma)
- âŒ No MCP (Model Context Protocol) implementations

#### Detection Strategy 2: Import/Include Pattern Matching

**Scanned all Kotlin source files in:**
- `composeApp/src/commonMain/kotlin/`
- `composeApp/src/androidMain/kotlin/`
- `composeApp/src/test/kotlin/`

**Search Results:**
- âŒ No `import anthropic` or `import com.anthropic`
- âŒ No `import openai` or `import com.openai`
- âŒ No `import google.generativeai`
- âŒ No `import com.google.cloud.aiplatform`
- âŒ No LLM framework imports

#### Detection Strategy 3: API Client Instantiation Patterns

**Scanned for patterns:**
- âŒ No `OpenAI(`, `Anthropic(`, `GenerativeModel(` instantiations
- âŒ No LLM client builders or factories

#### Detection Strategy 4: API Method Call Patterns

**Searched for characteristic LLM API calls:**
- âŒ No `.messages.create(`
- âŒ No `.chat.completions.create(`
- âŒ No `.generateContent(`
- âŒ No `.complete(` or `.completion(` with prompt parameters

**HTTP Client Analysis:**
The application uses Ktor for HTTP requests, but examination of network-related code shows:
- API calls to OMS (Order Management System) backend endpoints
- IoT device communication endpoints
- No calls to LLM API endpoints (api.openai.com, api.anthropic.com, etc.)

#### Detection Strategy 5: Configuration and Environment Variables

**Examined:**
- `google-services.json` - Firebase configuration only
- `gradle.properties` - Build configuration only
- No `.env` files present

**Findings:**
- âŒ No `OPENAI_API_KEY`
- âŒ No `ANTHROPIC_API_KEY`
- âŒ No `GOOGLE_AI_KEY` or `GEMINI_API_KEY`
- âŒ No LLM model configuration (temperature, max_tokens, etc.)

#### Detection Strategy 6: Prompt-Related Patterns

**Searched for:**
- âŒ No variables named `prompt`, `system_prompt`, `user_prompt`
- âŒ No prompt template files (`.prompt`, `.tmpl`)
- âŒ No `prompts/` directory
- âŒ No few-shot learning examples or chain-of-thought patterns

#### Detection Strategy 7: Custom Implementation Patterns

**File/Directory Name Analysis:**
- âŒ No files containing `llm`, `ai`, `ml`, `claude`, `gpt`, `analyzer`, `generator` in AI context
- âŒ No classes implementing text generation or AI analysis

**Documentation Review:**
From `docs/architecture.md`, `docs/api-integration.md`, and other documentation:
- Application is a Kotlin Multiplatform (KMP) mobile app
- Combines OMS (Order Management System) and IoT functionality
- Uses standard REST APIs for backend communication
- Implements offline-first architecture with Room database
- No mention of AI/LLM features or integration

### 1.2 Repository Purpose Analysis

Based on the codebase examination:

**Application Type:** Kotlin Multiplatform Mobile Application (Android)

**Primary Features:**
1. Order Management System (OMS) functionality
2. IoT device monitoring and control
3. Offline-first data synchronization
4. Firebase integration for authentication/notifications

**Technology Stack:**
- Kotlin Multiplatform (KMP)
- Jetpack Compose for UI
- Ktor for HTTP networking
- Room for local database
- Koin for dependency injection
- Firebase for cloud services

### 1.3 LLM Usage Summary

**Total LLM Integrations Found:** 0

**Detection Confidence:** HIGH

**Rationale:**
- No LLM-related dependencies in any build files
- No LLM SDK imports in source code
- No API calls to LLM services
- No prompt templates or prompt engineering patterns
- No AI-related configuration or environment variables
- Documentation confirms this is a traditional mobile app without AI features

---

## Final Assessment

**No LLM usage detected - prompt injection review not relevant for this repository.**

This repository contains a Kotlin Multiplatform mobile application for Order Management System (OMS) and IoT device management. The application:

- Uses traditional REST APIs for backend communication
- Implements offline-first data synchronization
- Does not integrate with any LLM providers (OpenAI, Anthropic, Google AI, etc.)
- Does not use any AI/ML frameworks or prompt engineering patterns
- Does not have any agent-based or RAG (Retrieval Augmented Generation) implementations

**Recommendation:** While prompt injection vulnerabilities are not applicable, standard security reviews should focus on:
- API authentication and authorization
- Input validation for REST endpoints
- Secure storage of credentials (Firebase, backend API tokens)
- SQL injection prevention in Room database queries
- Secure offline data storage